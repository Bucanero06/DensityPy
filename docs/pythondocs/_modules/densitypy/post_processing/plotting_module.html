<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>post_processing.plotting_module &mdash; DensityPy 0.0.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=92fd9be5" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css?v=eafc0fe6" />

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js?v=f6245a2f"></script>
        <script src="../../../_static/doctools.js?v=888ff710"></script>
        <script src="../../../_static/sphinx_highlight.js?v=4825356b"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            DensityPy
          </a>
              <div class="version">
                0.0.1
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../cli_run.html">cli_run</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Default_Settings.default_config.html">Default_Settings.default_config</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../autodocumentation_fortran.html">autodocumentation_fortran</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../autodocumentation_python.html">autodocumentation_python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../charge_migration.chargemigratonscripts.html">charge_migration.chargemigratonscripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../charge_migration.difference_dipole_charge.html">charge_migration.difference_dipole_charge</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../main.html">main</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../molcas.DipolesLogParser.html">molcas.DipolesLogParser</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../molcas.molcasscripts.html">molcas.molcasscripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../molcas.pegamoid.html">molcas.pegamoid</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../molcas.selectionofactivespace.html">molcas.selectionofactivespace</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../post_processing.chden_plotting_needs_work_to_update.plotdensity.html">post_processing.chden_plotting_needs_work_to_update.plotdensity</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../post_processing.chden_plotting_needs_work_to_update.plottingscripts.html">post_processing.chden_plotting_needs_work_to_update.plottingscripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../post_processing.chden_plotting_needs_work_to_update.rpoints2vtk.html">post_processing.chden_plotting_needs_work_to_update.rpoints2vtk</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../post_processing.plotting_module.html">post_processing.plotting_module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../project_utils.command_execution.html">project_utils.command_execution</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../project_utils.configuration_parser.html">project_utils.configuration_parser</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../project_utils.data_processing_utils.html">project_utils.data_processing_utils</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../project_utils.file_directory_ops.html">project_utils.file_directory_ops</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../project_utils.file_parsing.html">project_utils.file_parsing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../project_utils.fortran_compilation_handler.html">project_utils.fortran_compilation_handler</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../project_utils.logger.html">project_utils.logger</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../project_utils.string_dict_utils.html">project_utils.string_dict_utils</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docs.pythondocs.source.conf.html">docs.pythondocs.source.conf</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">DensityPy</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">post_processing.plotting_module</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for post_processing.plotting_module</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">os.path</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">colors</span>
<span class="kn">from</span> <span class="nn">scipy.ndimage</span> <span class="kn">import</span> <span class="n">gaussian_filter</span>

<span class="kn">from</span> <span class="nn">molcas.molcasscripts</span> <span class="kn">import</span> <span class="n">read_xyz</span>
<span class="kn">from</span> <span class="nn">project_utils.logger</span> <span class="kn">import</span> <span class="n">setup_logger</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">setup_logger</span><span class="p">(</span><span class="vm">__name__</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

<span class="sd">&#39;&#39;&#39;Pulses(FT) VS Time &amp; Frequency&#39;&#39;&#39;</span>


<div class="viewcode-block" id="plot_pulses"><a class="viewcode-back" href="../../../post_processing.plotting_module.html#post_processing.plotting_module.plot_pulses">[docs]</a><span class="k">def</span> <span class="nf">plot_pulses</span><span class="p">(</span><span class="n">study_directory</span><span class="p">,</span> <span class="n">experiment_directory</span><span class="p">,</span> <span class="n">time_delays</span><span class="p">,</span> <span class="n">min_time</span><span class="p">,</span> <span class="n">max_time</span><span class="p">,</span> <span class="n">plot_all</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="n">length_of_data_to_match</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="c1"># Plotting the pulse data</span>
    <span class="k">if</span> <span class="n">plot_all</span><span class="p">:</span>
        <span class="n">time_delays_to_plot</span> <span class="o">=</span> <span class="n">time_delays</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">zero_time_delay</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">time_delays</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="mi">0</span><span class="p">))</span>
        <span class="n">one_third_max_time_delay</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">time_delays</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="nb">max</span><span class="p">(</span><span class="n">time_delays</span><span class="p">)</span> <span class="o">/</span> <span class="mi">3</span><span class="p">))</span>
        <span class="n">two_third_max_time_delay</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">time_delays</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="nb">max</span><span class="p">(</span><span class="n">time_delays</span><span class="p">)</span> <span class="o">/</span> <span class="mi">3</span><span class="p">))</span>
        <span class="n">max_time_delay</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">time_delays</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="nb">max</span><span class="p">(</span><span class="n">time_delays</span><span class="p">)))</span>

        <span class="c1"># Lets also do the same for the minimum time delay and the &quot;thirds&quot; splits as before (remember to get as close as possible to a number</span>
        <span class="n">min_time_delay</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">time_delays</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="nb">min</span><span class="p">(</span><span class="n">time_delays</span><span class="p">)))</span>
        <span class="n">one_third_min_time_delay</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">time_delays</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="nb">min</span><span class="p">(</span><span class="n">time_delays</span><span class="p">)</span> <span class="o">/</span> <span class="mi">3</span><span class="p">))</span>
        <span class="n">two_third_min_time_delay</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">time_delays</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="nb">min</span><span class="p">(</span><span class="n">time_delays</span><span class="p">)</span> <span class="o">/</span> <span class="mi">3</span><span class="p">))</span>

        <span class="n">time_delays_to_plot</span> <span class="o">=</span> <span class="p">[</span><span class="n">zero_time_delay</span><span class="p">,</span> <span class="n">one_third_max_time_delay</span><span class="p">,</span> <span class="n">two_third_max_time_delay</span><span class="p">,</span> <span class="n">max_time_delay</span><span class="p">,</span>
                               <span class="n">min_time_delay</span><span class="p">,</span> <span class="n">one_third_min_time_delay</span><span class="p">,</span> <span class="n">two_third_min_time_delay</span><span class="p">]</span>

    <span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>

    <span class="k">for</span> <span class="n">time_delay</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;XUV&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">time_delays_to_plot</span><span class="p">:</span>
        <span class="n">file_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">study_directory</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">experiment_directory</span><span class="si">}</span><span class="s1">/Pulses/pulsePP</span><span class="si">{</span><span class="n">time_delay</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">if</span> <span class="n">time_delay</span> <span class="o">!=</span> <span class="s1">&#39;XUV&#39;</span> <span class="k">else</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">study_directory</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">experiment_directory</span><span class="si">}</span><span class="s1">/Pulses/pulseXUV&#39;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">delim_whitespace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                               <span class="n">names</span><span class="o">=</span><span class="p">[</span>
                                   <span class="s1">&#39;Time&#39;</span><span class="p">,</span>
                                   <span class="s1">&#39;Ax&#39;</span><span class="p">,</span>
                                   <span class="s1">&#39;Ay&#39;</span><span class="p">,</span>
                                   <span class="s1">&#39;Az&#39;</span><span class="p">,</span>
                                   <span class="s1">&#39;Real_zw_m1&#39;</span><span class="p">,</span>
                                   <span class="s1">&#39;Imag_zw_m1&#39;</span><span class="p">,</span>
                                   <span class="s1">&#39;Real_zw_p0&#39;</span><span class="p">,</span>
                                   <span class="s1">&#39;Imag_zw_p0&#39;</span><span class="p">,</span>
                                   <span class="s1">&#39;Real_zw_p1&#39;</span><span class="p">,</span>
                                   <span class="s1">&#39;Imag_zw_p1&#39;</span>
                               <span class="p">])</span>
        <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;File </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s1"> not found&#39;</span><span class="p">)</span>
            <span class="k">continue</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Plotting </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">length_of_data_to_match</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">length_of_data_to_match</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">length_of_data_to_match</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;Length of </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s1"> is not the same as the previous file&#39;</span>

        <span class="c1"># logger.info all columns in pandas</span>
        <span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.max_columns&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Length of data: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Time&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="n">col</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Column </span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time (arbitrary units)&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Value&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">time_delay</span> <span class="o">!=</span> <span class="s1">&#39;XUV&#39;</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Pulse Characteristics (pulsePP</span><span class="si">{</span><span class="n">time_delay</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Pulse Characteristics (pulseXUV)&#39;</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">min_time</span><span class="p">,</span> <span class="n">max_time</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># plt.show()</span>
        <span class="n">output_file</span> <span class="o">=</span> <span class="n">file_path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.csv&#39;</span><span class="p">,</span> <span class="s1">&#39;.png&#39;</span><span class="p">)</span>
        <span class="n">output_file</span> <span class="o">=</span> <span class="n">output_file</span> <span class="k">if</span> <span class="n">output_file</span> <span class="o">!=</span> <span class="n">file_path</span> <span class="k">else</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s1">.png&#39;</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">output_file</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="plot_ft_pulses"><a class="viewcode-back" href="../../../post_processing.plotting_module.html#post_processing.plotting_module.plot_ft_pulses">[docs]</a><span class="k">def</span> <span class="nf">plot_ft_pulses</span><span class="p">(</span><span class="n">study_directory</span><span class="p">,</span> <span class="n">experiment_directory</span><span class="p">,</span> <span class="n">time_delays</span><span class="p">,</span> <span class="n">plot_all</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plotting the FT pulse data</span>

<span class="sd">    Expected file name formats:</span>
<span class="sd">        FTpulsePP{delay} and FTpulseXUV</span>

<span class="sd">    Columns:</span>
<span class="sd">        Freq: The frequency at which the Fourier transform is computed.</span>
<span class="sd">        FTAx: The x-component of the Fourier-transformed vector potential.</span>
<span class="sd">        FTAy: The y-component of the Fourier-transformed vector potential.</span>
<span class="sd">        FTAz: The z-component of the Fourier-transformed vector potential.</span>
<span class="sd">        FT_Aminus1_Real and FT_Aminus1_Imag: The real and imaginary parts of the Fourier transform for the mu = -1 component.</span>
<span class="sd">        FT_A0_Real and FT_A0_Imag: The real and imaginary parts of the Fourier transform for the mu = 0 component.</span>
<span class="sd">        FT_Aplus1_Real and FT_Aplus1_Imag: The real and imaginary parts of the Fourier transform for the mu = +1 component.</span>

<span class="sd">    :param study_directory:</span>
<span class="sd">    :param experiment_directory:</span>
<span class="sd">    :param time_delays:</span>
<span class="sd">    :param plot_all:</span>
<span class="sd">    :return:</span>

<span class="sd">    Output:</span>
<span class="sd">        FTpulsePP{delay}.png and FTpulseXUV.png</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Plotting the pulse data</span>
    <span class="k">if</span> <span class="n">plot_all</span><span class="p">:</span>
        <span class="n">time_delays_to_plot</span> <span class="o">=</span> <span class="n">time_delays</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Lets also do the same for the minimum time delay and the &quot;thirds&quot; splits as before (remember to get as close as possible to a number</span>
        <span class="n">zero_time_delay</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">time_delays</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="mi">0</span><span class="p">))</span>
        <span class="n">one_third_max_time_delay</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">time_delays</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="nb">max</span><span class="p">(</span><span class="n">time_delays</span><span class="p">)</span> <span class="o">/</span> <span class="mi">3</span><span class="p">))</span>
        <span class="n">two_third_max_time_delay</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">time_delays</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="nb">max</span><span class="p">(</span><span class="n">time_delays</span><span class="p">)</span> <span class="o">/</span> <span class="mi">3</span><span class="p">))</span>
        <span class="n">max_time_delay</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">time_delays</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="nb">max</span><span class="p">(</span><span class="n">time_delays</span><span class="p">)))</span>
        <span class="n">min_time_delay</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">time_delays</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="nb">min</span><span class="p">(</span><span class="n">time_delays</span><span class="p">)))</span>
        <span class="n">one_third_min_time_delay</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">time_delays</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="nb">min</span><span class="p">(</span><span class="n">time_delays</span><span class="p">)</span> <span class="o">/</span> <span class="mi">3</span><span class="p">))</span>
        <span class="n">two_third_min_time_delay</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">time_delays</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="nb">min</span><span class="p">(</span><span class="n">time_delays</span><span class="p">)</span> <span class="o">/</span> <span class="mi">3</span><span class="p">))</span>

        <span class="n">time_delays_to_plot</span> <span class="o">=</span> <span class="p">[</span><span class="n">zero_time_delay</span><span class="p">,</span> <span class="n">one_third_max_time_delay</span><span class="p">,</span> <span class="n">two_third_max_time_delay</span><span class="p">,</span> <span class="n">max_time_delay</span><span class="p">,</span>
                               <span class="n">min_time_delay</span><span class="p">,</span> <span class="n">one_third_min_time_delay</span><span class="p">,</span> <span class="n">two_third_min_time_delay</span><span class="p">]</span>

    <span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
    <span class="k">for</span> <span class="n">time_delay</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;XUV&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">time_delays_to_plot</span><span class="p">:</span>
        <span class="n">file_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">study_directory</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">experiment_directory</span><span class="si">}</span><span class="s1">/Pulses/FTpulsePP</span><span class="si">{</span><span class="n">time_delay</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">if</span> <span class="n">time_delay</span> <span class="o">!=</span> <span class="s1">&#39;XUV&#39;</span> <span class="k">else</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">study_directory</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">experiment_directory</span><span class="si">}</span><span class="s1">/Pulses/FTpulseXUV&#39;</span>
        <span class="c1">#</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">delim_whitespace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                               <span class="n">names</span><span class="o">=</span><span class="p">[</span>
                                   <span class="s1">&#39;Freq&#39;</span><span class="p">,</span>
                                   <span class="s1">&#39;FTAx&#39;</span><span class="p">,</span>
                                   <span class="s1">&#39;FTAy&#39;</span><span class="p">,</span>
                                   <span class="s1">&#39;FTAz&#39;</span><span class="p">,</span>
                                   <span class="s1">&#39;FT_Aminus1_Real&#39;</span><span class="p">,</span>
                                   <span class="s1">&#39;FT_Aminus1_Imag&#39;</span><span class="p">,</span>
                                   <span class="s1">&#39;FT_A0_Real&#39;</span><span class="p">,</span>
                                   <span class="s1">&#39;FT_A0_Imag&#39;</span><span class="p">,</span>
                                   <span class="s1">&#39;FT_Aplus1_Real&#39;</span><span class="p">,</span>
                                   <span class="s1">&#39;FT_Aplus1_Imag&#39;</span>
                               <span class="p">])</span>
        <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;File </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s1"> not found&#39;</span><span class="p">)</span>
            <span class="k">continue</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Plotting </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Length of data: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Freq&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="n">col</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Column </span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="c1"># plt.plot(data[&#39;Time&#39;], data[&#39;Ax&#39;], label=f&#39;Column Ax&#39;)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Frequency (arbitrary units)&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Value&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">time_delay</span> <span class="o">!=</span> <span class="s1">&#39;XUV&#39;</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Pulse Characteristics (FTpulsePP</span><span class="si">{</span><span class="n">time_delay</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Pulse Characteristics (FTpulseXUV)&#39;</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># plt.show()</span>
        <span class="n">output_file</span> <span class="o">=</span> <span class="n">file_path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.csv&#39;</span><span class="p">,</span> <span class="s1">&#39;.png&#39;</span><span class="p">)</span>
        <span class="n">output_file</span> <span class="o">=</span> <span class="n">output_file</span> <span class="k">if</span> <span class="n">output_file</span> <span class="o">!=</span> <span class="n">file_path</span> <span class="k">else</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s1">.png&#39;</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">output_file</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">)</span></div>


<span class="sd">&#39;&#39;&#39;Dipoles VS Time&#39;&#39;&#39;</span>


<div class="viewcode-block" id="plot_dipoles_v_time"><a class="viewcode-back" href="../../../post_processing.plotting_module.html#post_processing.plotting_module.plot_dipoles_v_time">[docs]</a><span class="k">def</span> <span class="nf">plot_dipoles_v_time</span><span class="p">(</span><span class="n">study_directory</span><span class="p">,</span> <span class="n">experiment_directory</span><span class="p">,</span> <span class="n">time_delays</span><span class="p">,</span> <span class="n">min_time</span><span class="p">,</span> <span class="n">max_time</span><span class="p">,</span> <span class="n">plot_all</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="c1"># Lets plot the Dipolar Reponse vs Time (t)</span>
    <span class="c1"># &quot;itime&quot;,&quot;Time&quot;,&quot;DipoleX_Re&quot;,&quot;DipoleX_Im&quot;,&quot;DipoleY_Re&quot;,&quot;DipoleY_Im&quot;,&quot;DipoleZ_Re&quot;,&quot;DipoleZ_Im&quot;</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plotting the dipole data vs time</span>

<span class="sd">    Expected file name formats:</span>
<span class="sd">        DipolePP{delay}.csv and DipoleXUV.csv</span>

<span class="sd">    Columns:</span>
<span class="sd">        itime: The time step at which the dipole is computed.</span>
<span class="sd">        Time: The time at which the dipole is computed.</span>
<span class="sd">        DipoleX_Re: The real part of the x-component of the dipole.</span>
<span class="sd">        DipoleX_Im: The imaginary part of the x-component of the dipole.</span>
<span class="sd">        DipoleY_Re: The real part of the y-component of the dipole.</span>
<span class="sd">        DipoleY_Im: The imaginary part of the y-component of the dipole.</span>
<span class="sd">        DipoleZ_Re: The real part of the z-component of the dipole.</span>
<span class="sd">        DipoleZ_Im: The imaginary part of the z-component of the dipole.</span>

<span class="sd">    :param study_directory:</span>
<span class="sd">    :param experiment_directory:</span>
<span class="sd">    :param time_delays:</span>
<span class="sd">    :param min_time:</span>
<span class="sd">    :param max_time:</span>
<span class="sd">    :param plot_all:</span>
<span class="sd">    :return:</span>

<span class="sd">    Output:</span>
<span class="sd">        DipolePP{delay}.png and DipoleXUV.png</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">length_of_data_to_match</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">plot_all</span><span class="p">:</span>
        <span class="n">time_delays_to_plot</span> <span class="o">=</span> <span class="n">time_delays</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Time delays to plot = [0, 1/3 max, 2/3 max, max] if not present then use the nearest. Do the same for min</span>
        <span class="n">zero_time_delay</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">time_delays</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="mi">0</span><span class="p">))</span>
        <span class="n">one_third_max_time_delay</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">time_delays</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="nb">max</span><span class="p">(</span><span class="n">time_delays</span><span class="p">)</span> <span class="o">/</span> <span class="mi">3</span><span class="p">))</span>
        <span class="n">two_third_max_time_delay</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">time_delays</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="nb">max</span><span class="p">(</span><span class="n">time_delays</span><span class="p">)</span> <span class="o">/</span> <span class="mi">3</span><span class="p">))</span>
        <span class="n">max_time_delay</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">time_delays</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="nb">max</span><span class="p">(</span><span class="n">time_delays</span><span class="p">)))</span>
        <span class="n">min_time_delay</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">time_delays</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="nb">min</span><span class="p">(</span><span class="n">time_delays</span><span class="p">)))</span>
        <span class="n">one_third_min_time_delay</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">time_delays</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="nb">min</span><span class="p">(</span><span class="n">time_delays</span><span class="p">)</span> <span class="o">/</span> <span class="mi">3</span><span class="p">))</span>
        <span class="n">two_third_min_time_delay</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">time_delays</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="nb">min</span><span class="p">(</span><span class="n">time_delays</span><span class="p">)</span> <span class="o">/</span> <span class="mi">3</span><span class="p">))</span>

        <span class="n">time_delays_to_plot</span> <span class="o">=</span> <span class="p">[</span><span class="n">zero_time_delay</span><span class="p">,</span> <span class="n">one_third_max_time_delay</span><span class="p">,</span> <span class="n">two_third_max_time_delay</span><span class="p">,</span> <span class="n">max_time_delay</span><span class="p">,</span>
                               <span class="n">min_time_delay</span><span class="p">,</span> <span class="n">one_third_min_time_delay</span><span class="p">,</span> <span class="n">two_third_min_time_delay</span><span class="p">]</span>

    <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

    <span class="k">for</span> <span class="n">time_delay</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;XUV&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">time_delays_to_plot</span><span class="p">:</span>
        <span class="c1"># Force close all plots</span>
        <span class="n">file_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">study_directory</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">experiment_directory</span><span class="si">}</span><span class="s1">/Dipole/DipolePP</span><span class="si">{</span><span class="n">time_delay</span><span class="si">}</span><span class="s1">.csv&#39;</span> <span class="k">if</span> <span class="n">time_delay</span> <span class="o">!=</span> <span class="s1">&#39;XUV&#39;</span> <span class="k">else</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">study_directory</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">experiment_directory</span><span class="si">}</span><span class="s1">/Dipole/DipoleXUV.csv&#39;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;File </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s1"> not found&#39;</span><span class="p">)</span>
            <span class="k">continue</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Plotting </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">length_of_data_to_match</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">length_of_data_to_match</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">length_of_data_to_match</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;Length of </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s1"> is not the same as the previous file&#39;</span>
            <span class="c1"># assert data.columns.tolist() in INDECES_COL_NAMES + FEATURES_COL_NAMES, f&#39;Column names of {file_path} is not the same as the previous file&#39;</span>

        <span class="c1"># Extracting relevant data for plotting</span>
        <span class="n">time</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Time&#39;</span><span class="p">]</span>
        <span class="n">dipole_x_re</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;DipoleX_Re&#39;</span><span class="p">]</span>
        <span class="n">dipole_x_im</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;DipoleX_Im&#39;</span><span class="p">]</span>
        <span class="n">dipole_y_re</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;DipoleY_Re&#39;</span><span class="p">]</span>
        <span class="n">dipole_y_im</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;DipoleY_Im&#39;</span><span class="p">]</span>
        <span class="n">dipole_z_re</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;DipoleZ_Re&#39;</span><span class="p">]</span>
        <span class="n">dipole_z_im</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;DipoleZ_Im&#39;</span><span class="p">]</span>

        <span class="c1"># Plotting the real and imaginary parts of the dipole components</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>
        <span class="c1"># Add the Main Top Title for the plot (file_path)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">dipole_x_re</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">min_time</span><span class="p">,</span> <span class="n">max_time</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Dipole X Real&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Dipole X Re&#39;</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">dipole_x_im</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">min_time</span><span class="p">,</span> <span class="n">max_time</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Dipole X Imaginary&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Dipole X Im&#39;</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">dipole_y_re</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">min_time</span><span class="p">,</span> <span class="n">max_time</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Dipole Y Real&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Dipole Y Re&#39;</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">dipole_y_im</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">min_time</span><span class="p">,</span> <span class="n">max_time</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Dipole Y Imaginary&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Dipole Y Im&#39;</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">dipole_z_re</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">min_time</span><span class="p">,</span> <span class="n">max_time</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Dipole Z Real&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Dipole Z Re&#39;</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">dipole_z_im</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">min_time</span><span class="p">,</span> <span class="n">max_time</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Dipole Z Imaginary&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Dipole Z Im&#39;</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="c1"># plt.show()</span>
        <span class="n">output_file</span> <span class="o">=</span> <span class="n">file_path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.csv&#39;</span><span class="p">,</span> <span class="s1">&#39;.png&#39;</span><span class="p">)</span>
        <span class="n">output_file</span> <span class="o">=</span> <span class="n">output_file</span> <span class="k">if</span> <span class="n">output_file</span> <span class="o">!=</span> <span class="n">file_path</span> <span class="k">else</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s1">.png&#39;</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">output_file</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="plot_atomic_dipoles_v_time"><a class="viewcode-back" href="../../../post_processing.plotting_module.html#post_processing.plotting_module.plot_atomic_dipoles_v_time">[docs]</a><span class="k">def</span> <span class="nf">plot_atomic_dipoles_v_time</span><span class="p">(</span><span class="n">study_directory</span><span class="p">,</span> <span class="n">experiment_directory</span><span class="p">,</span> <span class="n">time_delays</span><span class="p">,</span> <span class="n">min_time</span><span class="p">,</span> <span class="n">max_time</span><span class="p">,</span>
                               <span class="n">xyz_geometry_path</span><span class="p">,</span> <span class="n">plot_all</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="c1"># Read the XYZ file to get the number of atoms, the name of the atom and the atom names</span>
    <span class="c1"># (this is the order in which the atoms are listed in the CSV file)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">xyz_geometry_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">number_of_atoms</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">())</span>
        <span class="n">name_of_molecule</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">atom_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number_of_atoms</span><span class="p">)]</span>

    <span class="nb">print</span><span class="p">(</span><span class="n">number_of_atoms</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">name_of_molecule</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">atom_names</span><span class="p">)</span>

    <span class="n">ATOMIC_COL_NAMES</span> <span class="o">=</span> <span class="n">__generate_atomic_charge_column_names</span><span class="p">(</span><span class="n">xyz_geometry_path</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">ATOMIC_COL_NAMES</span><span class="w">  </span><span class="si">= }</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span>
        <span class="n">ATOMIC_COL_NAMES</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">number_of_atoms</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;Number of columns in </span><span class="si">{</span><span class="n">xyz_geometry_path</span><span class="si">}</span><span class="s1"> does not match the number of atoms&#39;</span>

    <span class="k">if</span> <span class="n">plot_all</span><span class="p">:</span>
        <span class="n">time_delays_to_plot</span> <span class="o">=</span> <span class="n">time_delays</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Time delays to plot = [0, 1/3 max, 2/3 max, max] if not present then use the nearest. Do the same for min</span>
        <span class="n">zero_time_delay</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">time_delays</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="mi">0</span><span class="p">))</span>
        <span class="n">one_third_max_time_delay</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">time_delays</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="nb">max</span><span class="p">(</span><span class="n">time_delays</span><span class="p">)</span> <span class="o">/</span> <span class="mi">3</span><span class="p">))</span>
        <span class="n">two_third_max_time_delay</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">time_delays</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="nb">max</span><span class="p">(</span><span class="n">time_delays</span><span class="p">)</span> <span class="o">/</span> <span class="mi">3</span><span class="p">))</span>
        <span class="n">max_time_delay</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">time_delays</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="nb">max</span><span class="p">(</span><span class="n">time_delays</span><span class="p">)))</span>
        <span class="n">min_time_delay</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">time_delays</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="nb">min</span><span class="p">(</span><span class="n">time_delays</span><span class="p">)))</span>
        <span class="n">one_third_min_time_delay</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">time_delays</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="nb">min</span><span class="p">(</span><span class="n">time_delays</span><span class="p">)</span> <span class="o">/</span> <span class="mi">3</span><span class="p">))</span>
        <span class="n">two_third_min_time_delay</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">time_delays</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="nb">min</span><span class="p">(</span><span class="n">time_delays</span><span class="p">)</span> <span class="o">/</span> <span class="mi">3</span><span class="p">))</span>

        <span class="n">time_delays_to_plot</span> <span class="o">=</span> <span class="p">[</span><span class="n">zero_time_delay</span><span class="p">,</span> <span class="n">one_third_max_time_delay</span><span class="p">,</span> <span class="n">two_third_max_time_delay</span><span class="p">,</span> <span class="n">max_time_delay</span><span class="p">,</span>
                               <span class="n">min_time_delay</span><span class="p">,</span> <span class="n">one_third_min_time_delay</span><span class="p">,</span> <span class="n">two_third_min_time_delay</span><span class="p">]</span>

    <span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>

    <span class="n">length_of_data_to_match</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">for</span> <span class="n">time_delay</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;XUV&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">time_delays_to_plot</span><span class="p">:</span>
        <span class="n">file_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">study_directory</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">experiment_directory</span><span class="si">}</span><span class="s1">/AtomicCharge/AtomicChargePP</span><span class="si">{</span><span class="n">time_delay</span><span class="si">}</span><span class="s1">.csv&#39;</span> <span class="k">if</span> <span class="n">time_delay</span> <span class="o">!=</span> <span class="s1">&#39;XUV&#39;</span> <span class="k">else</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">study_directory</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">experiment_directory</span><span class="si">}</span><span class="s1">/AtomicCharge/AtomicChargeXUV.csv&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;File </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s1"> not found&#39;</span><span class="p">)</span>
            <span class="k">continue</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Plotting </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">()</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="w">  </span><span class="si">= }</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span><span class="w">  </span><span class="si">= }</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">ATOMIC_COL_NAMES</span><span class="w">  </span><span class="si">= }</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">length_of_data_to_match</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">length_of_data_to_match</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">length_of_data_to_match</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;Length of </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s1"> is not the same as the previous file&#39;</span>
            <span class="c1"># assert data.columns.tolist() in ATOMIC_COL_NAMES, f&#39;Column names of {file_path} is not the same as the previous file&#39;</span>

        <span class="c1"># Extracting relevant data for plotting</span>
        <span class="n">time</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Time&#39;</span><span class="p">]</span>
        <span class="n">total_charge</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;TotalCharge&#39;</span><span class="p">]</span>
        <span class="n">atom_charges</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;itime&#39;</span><span class="p">,</span> <span class="s1">&#39;Time&#39;</span><span class="p">,</span> <span class="s1">&#39;TotalCharge&#39;</span><span class="p">])</span>

        <span class="c1"># Subplots for xyz and total charge in one figure , each of the xyz will have all the atoms</span>
        <span class="c1"># Plotting charge thus is all real</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>
        <span class="c1"># Add the Main Top Title for the plot (file_path)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">total_charge</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">min_time</span><span class="p">,</span> <span class="n">max_time</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Total Charge sum(Charge(iPol, iAtom, it))&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time (t)&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Total Charge&#39;</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">atom_charges</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;ChargeX&#39;</span> <span class="ow">in</span> <span class="n">col</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">atom_charges</span><span class="p">[</span><span class="n">col</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Column </span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">min_time</span><span class="p">,</span> <span class="n">max_time</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Atomic Charges X-Axis&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time (t)&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Atomic Charges&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">atom_charges</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;ChargeY&#39;</span> <span class="ow">in</span> <span class="n">col</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">atom_charges</span><span class="p">[</span><span class="n">col</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Column </span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">min_time</span><span class="p">,</span> <span class="n">max_time</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Atomic Charges Y-Axis&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time (t)&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Atomic Charges&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">atom_charges</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;ChargeZ&#39;</span> <span class="ow">in</span> <span class="n">col</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">atom_charges</span><span class="p">[</span><span class="n">col</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Column </span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">min_time</span><span class="p">,</span> <span class="n">max_time</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Atomic Charges Z-Axis&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time (t)&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Atomic Charges&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="c1"># plt.show()</span>
        <span class="n">output_file</span> <span class="o">=</span> <span class="n">file_path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.csv&#39;</span><span class="p">,</span> <span class="s1">&#39;.png&#39;</span><span class="p">)</span>
        <span class="n">output_file</span> <span class="o">=</span> <span class="n">output_file</span> <span class="k">if</span> <span class="n">output_file</span> <span class="o">!=</span> <span class="n">file_path</span> <span class="k">else</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s1">.png&#39;</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">output_file</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="difference_between_dipole_and_atomic_charges_v_time"><a class="viewcode-back" href="../../../post_processing.plotting_module.html#post_processing.plotting_module.difference_between_dipole_and_atomic_charges_v_time">[docs]</a><span class="k">def</span> <span class="nf">difference_between_dipole_and_atomic_charges_v_time</span><span class="p">(</span><span class="n">study_directory</span><span class="p">,</span> <span class="n">experiment_directory</span><span class="p">,</span> <span class="n">time_delays</span><span class="p">,</span> <span class="n">min_time</span><span class="p">,</span>
                                                        <span class="n">max_time</span><span class="p">,</span>
                                                        <span class="n">xyz_geometry_path</span><span class="p">):</span>
    <span class="k">raise</span> <span class="ne">NotImplementedError</span>
    <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

    <span class="c1"># Load the datasets</span>
    <span class="n">atomic_charge_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">study_directory</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">experiment_directory</span><span class="si">}</span><span class="s1">/AtomicCharge/AtomicChargeXUV.csv&#39;</span>
    <span class="n">dipole_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">study_directory</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">experiment_directory</span><span class="si">}</span><span class="s1">/Dipole/DipoleXUV.csv&#39;</span>

    <span class="n">atomic_charge_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">atomic_charge_file</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">dipole_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">dipole_file</span><span class="p">)</span>

    <span class="n">ATOMIC_COL_NAMES</span> <span class="o">=</span> <span class="n">__generate_atomic_charge_column_names</span><span class="p">(</span><span class="n">xyz_geometry_path</span><span class="p">)</span>
    <span class="n">xyz_file_content</span> <span class="o">=</span> <span class="n">read_xyz</span><span class="p">(</span><span class="n">xyz_geometry_path</span><span class="p">)</span>

    <span class="c1"># Reconstruct Dipole Response from Atomic Charges</span>
    <span class="n">R_el_bc</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">study_directory</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">experiment_directory</span><span class="si">}</span><span class="s1">/R_el_bc.csv&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">R_el_bc</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="n">atomic_dipole_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">atom_name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">xyz_file_content</span><span class="p">[</span><span class="s1">&#39;atoms&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
        <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">axis</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="s1">&#39;Z&#39;</span><span class="p">]):</span>
            <span class="n">column_name</span> <span class="o">=</span> <span class="n">ATOMIC_COL_NAMES</span><span class="p">[</span><span class="mi">3</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="n">j</span><span class="p">]</span>
            <span class="c1"># atomic_dipole_data[column_name] = atomic_charge_data[column_name] * R_el_bc[axis + &#39;_Position&#39;][i]</span>
            <span class="n">atomic_dipole_data</span><span class="p">[</span><span class="n">column_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">atomic_charge_data</span><span class="p">[</span><span class="n">column_name</span><span class="p">]</span> <span class="o">*</span> <span class="n">xyz_file_content</span><span class="p">[</span><span class="s1">&#39;atoms&#39;</span><span class="p">][</span><span class="n">atom_name</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>

    <span class="c1"># Comparing the sum of all dipoles with the total charge</span>
    <span class="n">comparison_with_sum</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
        <span class="s1">&#39;Time&#39;</span><span class="p">:</span> <span class="n">atomic_charge_data</span><span class="p">[</span><span class="s1">&#39;Time&#39;</span><span class="p">],</span>
        <span class="s1">&#39;Total_Charge&#39;</span><span class="p">:</span> <span class="n">atomic_charge_data</span><span class="p">[</span><span class="s1">&#39;TotalCharge&#39;</span><span class="p">],</span>
        <span class="c1"># dont know why atomic needs to be reversed, is seen across this file</span>
        <span class="s1">&#39;Sum_Dipole_across_XYZ_ReIm&#39;</span><span class="p">:</span> <span class="n">dipole_data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
        <span class="c1"># &#39;Sum_Reconstructed_Dipole_across_XYZ&#39;: atomic_dipole_data.sum(axis=1)</span>
    <span class="p">})</span>

    <span class="nb">print</span><span class="p">(</span><span class="n">comparison_with_sum</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>

    <span class="c1"># Plotting the comparison</span>
    <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">study_directory</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">experiment_directory</span><span class="si">}</span><span class="s1"> Dipole/Charge XUV Comparison&#39;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">comparison_with_sum</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">1</span><span class="p">:]):</span>
        <span class="c1"># Subplots for xyz and total charge in one figure , each of the xyz will have all the atoms</span>
        <span class="c1"># Plotting charge thus is all real</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">comparison_with_sum</span><span class="p">[</span><span class="s1">&#39;Time&#39;</span><span class="p">],</span> <span class="n">comparison_with_sum</span><span class="p">[</span><span class="n">col</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Column </span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="c1"># subtitle for subplot</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="c1"># Find the Error between the sum of the dipoles and the total charge</span>
    <span class="n">comparison_with_sum</span><span class="p">[</span><span class="s1">&#39;Mean Absolute Error (MAE)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">comparison_with_sum</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
        <span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="o">-</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;Total_Charge&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Sum_Dipole_across_XYZ_ReIm&#39;</span><span class="p">]),</span>
        <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># fixme this is wrong right? but error big when not negating the charge</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">comparison_with_sum</span><span class="p">[</span><span class="s1">&#39;Time&#39;</span><span class="p">],</span> <span class="n">comparison_with_sum</span><span class="p">[</span><span class="s1">&#39;Mean Absolute Error (MAE)&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;MAE&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Error&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Value&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># plt.show()</span>
    <span class="n">output_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">study_directory</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">experiment_directory</span><span class="si">}</span><span class="s1">/AtomicCharge/AtomicChargeXUV_vs_DipoleXUV.png&#39;</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">output_file</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">)</span></div>


<span class="sd">&#39;&#39;&#39;Dipoles(FT) VS Time &amp; Frequency&#39;&#39;&#39;</span>


<div class="viewcode-block" id="plot_ft_all_dipoles_v_time"><a class="viewcode-back" href="../../../post_processing.plotting_module.html#post_processing.plotting_module.plot_ft_all_dipoles_v_time">[docs]</a><span class="k">def</span> <span class="nf">plot_ft_all_dipoles_v_time</span><span class="p">(</span><span class="n">study_directory</span><span class="p">,</span> <span class="n">experiment_directory</span><span class="p">,</span> <span class="n">dephasing_factor</span><span class="p">,</span> <span class="n">relaxation_factor</span><span class="p">,</span>
                               <span class="n">pump_settings</span><span class="p">,</span> <span class="n">probe_settings</span><span class="p">,</span> <span class="n">charge_migration_ft_settings</span><span class="p">,</span> <span class="n">try_color_maps</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plotting the FT dipole data vs time, vs frequency and vs time and frequency</span>

<span class="sd">    Currently is limited to a pump probe experiment with two pulses since, specifically using the central_time_2</span>
<span class="sd">    column as the tau time delay axis</span>

<span class="sd">    :param study_directory:</span>
<span class="sd">    :param experiment_directory:</span>
<span class="sd">    :param dephasing_factor:</span>
<span class="sd">    :param relaxation_factor:</span>
<span class="sd">    :param pump_settings:</span>
<span class="sd">    :param probe_settings:</span>
<span class="sd">    :param charge_migration_ft_settings:</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># &quot;number_of_pulses&quot;, &quot;central_time_1&quot;, &quot;carrier_frequency_1&quot;, &quot;fwhm_1&quot;, &quot;carrier_envelope_phase_1&quot;,</span>
    <span class="c1">#   &quot;intensity_1&quot;, &quot;amplitude_1&quot;, &quot;period_1&quot;, &quot;central_time_...&quot;, &quot;carrier_frequency_...&quot;, &quot;fwhm_...&quot;,</span>
    <span class="c1">#   &quot;carrier_envelope_phase_...&quot;, &quot;intensity_...&quot;, &quot;amplitude_...&quot;, &quot;period_...&quot;, &quot;iOmega&quot;, &quot;OmegaVec&quot;, &quot;FTDipoleX_Re&quot;,</span>
    <span class="c1">#   &quot;FTDipoleX_Im&quot;, &quot;FTDipoleY_Re&quot;, &quot;FTDipoleY_Im&quot;, &quot;FTDipoleZ_Re&quot;, &quot;FTDipoleZ_Im&quot;</span>

    <span class="n">FILE_PATH</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">study_directory</span><span class="p">,</span><span class="w"> </span><span class="n">experiment_directory</span><span class="p">)</span><span class="si">}</span><span class="s1">/Dipole/DipoleFT_ALL.csv&#39;</span>

    <span class="c1"># Pump Settings</span>
    <span class="n">type_of_pulse_pump</span> <span class="o">=</span> <span class="n">pump_settings</span><span class="p">[</span><span class="s1">&#39;typeofpulse&#39;</span><span class="p">]</span>
    <span class="n">start_time</span> <span class="o">=</span> <span class="n">pump_settings</span><span class="p">[</span><span class="s1">&#39;starttime&#39;</span><span class="p">]</span>
    <span class="n">pump_central_frequency</span> <span class="o">=</span> <span class="n">pump_settings</span><span class="p">[</span><span class="s1">&#39;pumpcentralfrequency&#39;</span><span class="p">]</span>
    <span class="n">pump_periods</span> <span class="o">=</span> <span class="n">pump_settings</span><span class="p">[</span><span class="s1">&#39;pumpperiods&#39;</span><span class="p">]</span>
    <span class="n">pump_phase</span> <span class="o">=</span> <span class="n">pump_settings</span><span class="p">[</span><span class="s1">&#39;pumpphase&#39;</span><span class="p">]</span>
    <span class="n">pump_intensity</span> <span class="o">=</span> <span class="n">pump_settings</span><span class="p">[</span><span class="s1">&#39;pumpintensity&#39;</span><span class="p">]</span>
    <span class="n">pump_polarization</span> <span class="o">=</span> <span class="n">pump_settings</span><span class="p">[</span><span class="s1">&#39;pumppolarization&#39;</span><span class="p">]</span>

    <span class="c1"># Probe Settings</span>
    <span class="n">type_of_pulse_probe</span> <span class="o">=</span> <span class="n">probe_settings</span><span class="p">[</span><span class="s1">&#39;typeofpulse&#39;</span><span class="p">]</span>
    <span class="n">time_delay_start</span> <span class="o">=</span> <span class="n">probe_settings</span><span class="p">[</span><span class="s1">&#39;timedelaystart&#39;</span><span class="p">]</span>
    <span class="n">time_delay_stop</span> <span class="o">=</span> <span class="n">probe_settings</span><span class="p">[</span><span class="s1">&#39;timedelaystop&#39;</span><span class="p">]</span>
    <span class="n">number_of_pp</span> <span class="o">=</span> <span class="n">probe_settings</span><span class="p">[</span><span class="s1">&#39;numberofpp&#39;</span><span class="p">]</span>
    <span class="n">time_Delay_weight_factor</span> <span class="o">=</span> <span class="n">probe_settings</span><span class="p">[</span><span class="s1">&#39;timedelayweightfactor&#39;</span><span class="p">]</span>
    <span class="n">probe_central_frequency</span> <span class="o">=</span> <span class="n">probe_settings</span><span class="p">[</span><span class="s1">&#39;probecentralfrequency&#39;</span><span class="p">]</span>
    <span class="n">probe_periods</span> <span class="o">=</span> <span class="n">probe_settings</span><span class="p">[</span><span class="s1">&#39;probeperiods&#39;</span><span class="p">]</span>
    <span class="n">probe_phase</span> <span class="o">=</span> <span class="n">probe_settings</span><span class="p">[</span><span class="s1">&#39;probephase&#39;</span><span class="p">]</span>
    <span class="n">probe_intensity</span> <span class="o">=</span> <span class="n">probe_settings</span><span class="p">[</span><span class="s1">&#39;probeintensity&#39;</span><span class="p">]</span>
    <span class="n">probe_polarization</span> <span class="o">=</span> <span class="n">probe_settings</span><span class="p">[</span><span class="s1">&#39;probepolarization&#39;</span><span class="p">]</span>

    <span class="c1"># Charge Migration Settings</span>
    <span class="n">ft_time_step</span> <span class="o">=</span> <span class="n">charge_migration_ft_settings</span><span class="p">[</span><span class="s1">&#39;fttimestep&#39;</span><span class="p">]</span>
    <span class="n">ft_width_step</span> <span class="o">=</span> <span class="n">charge_migration_ft_settings</span><span class="p">[</span><span class="s1">&#39;ftwidthstep&#39;</span><span class="p">]</span>

    <span class="c1"># Lets plot the Spectra FT Dipolar Reponse vs Time (t)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">FILE_PATH</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Length of data: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="c1"># Plotting the real and imaginary parts of the dipole components</span>
    <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">FILE_PATH</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">col_end_name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="s1">&#39;X_Re&#39;</span><span class="p">,</span> <span class="s1">&#39;X_Im&#39;</span><span class="p">,</span> <span class="s1">&#39;Y_Re&#39;</span><span class="p">,</span> <span class="s1">&#39;Y_Im&#39;</span><span class="p">,</span> <span class="s1">&#39;Z_Re&#39;</span><span class="p">,</span> <span class="s1">&#39;Z_Im&#39;</span><span class="p">]):</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;central_time_2&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;FTDipole</span><span class="si">{</span><span class="n">col_end_name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;FTDipole</span><span class="si">{</span><span class="n">col_end_name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;central_time_2&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;FTDipole</span><span class="si">{</span><span class="n">col_end_name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="c1"># plt.show()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">study_directory</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">experiment_directory</span><span class="si">}</span><span class="s1">/Dipole/DipoleFT_ALL_Components_vs_central_time_2.png&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Average FT Dipole Magnitude: </span>
<span class="sd">    X=central_time_2, Y=OmegaVec, </span>
<span class="sd">    Z=((FTDipoleX_Re**2+FTDipoleX_Im**2+FTDipoleY_Re**2+FTDipoleY_Im**2+FTDipoleZ_Re**2+FTDipoleZ_Im**2)/3)**0.5</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Calculating the average of the squared magnitudes of the FT dipole components</span>
    <span class="n">average_ft_dipole</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;FTDipoleX_Re&#39;</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;FTDipoleX_Im&#39;</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span>
                                 <span class="n">data</span><span class="p">[</span><span class="s1">&#39;FTDipoleY_Re&#39;</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;FTDipoleY_Im&#39;</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span>
                                 <span class="n">data</span><span class="p">[</span><span class="s1">&#39;FTDipoleZ_Re&#39;</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;FTDipoleZ_Im&#39;</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)</span>

    <span class="c1"># Creating an interactive plot using Plotly</span>
    <span class="n">_plot_contour_map</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;central_time_2&#39;</span><span class="p">],</span>
                      <span class="n">y</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;OmegaVec&#39;</span><span class="p">],</span>
                      <span class="n">z</span><span class="o">=</span><span class="n">average_ft_dipole</span><span class="p">,</span>
                      <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Contour Map of Average FT Dipole Magnitude</span><span class="se">\n</span><span class="s1">&#39;</span>
                            <span class="sa">f</span><span class="s1">&#39;DipoleFT_ALL.csv</span><span class="se">\n</span><span class="s1">&#39;</span>
                            <span class="sa">f</span><span class="s1">&#39;Pump Settings:  </span><span class="si">{</span><span class="n">pump_central_frequency</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="n">pump_periods</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="n">pump_phase</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="n">pump_intensity</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="n">pump_polarization</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span>
                            <span class="sa">f</span><span class="s1">&#39;Probe Settings:  </span><span class="si">{</span><span class="n">probe_central_frequency</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="n">probe_periods</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="n">probe_phase</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="n">probe_intensity</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="n">probe_polarization</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span>
                            <span class="sa">f</span><span class="s1">&#39;Dephasing Factor: </span><span class="si">{</span><span class="n">dephasing_factor</span><span class="si">}</span><span class="s1">, Relaxation Factor: </span><span class="si">{</span><span class="n">relaxation_factor</span><span class="si">}</span><span class="s1">&#39;</span>
                            <span class="sa">f</span><span class="s1">&#39;FT Time Step: </span><span class="si">{</span><span class="n">ft_time_step</span><span class="si">}</span><span class="s1">, FT Width Step: </span><span class="si">{</span><span class="n">ft_width_step</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
                      <span class="n">x_label</span><span class="o">=</span><span class="s1">&#39;Central Time 2 - Probe (tau)&#39;</span><span class="p">,</span>
                      <span class="n">y_label</span><span class="o">=</span><span class="s1">&#39;OmegaVec&#39;</span><span class="p">,</span>
                      <span class="n">output_file</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">study_directory</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">experiment_directory</span><span class="si">}</span><span class="s1">/Dipole/DipoleFT_ALL_Contour.html&#39;</span><span class="p">)</span>

    <span class="c1"># Plotting</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

    <span class="c1"># Plotting the real parts</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;OmegaVec&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;FTDipoleX_Re&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;FTDipoleX_Re&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;OmegaVec&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;FTDipoleY_Re&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;FTDipoleY_Re&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;OmegaVec&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;FTDipoleZ_Re&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;FTDipoleZ_Re&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Real Components of FT Dipoles vs OmegaVec&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;OmegaVec&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Real Part of FT Dipole&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

    <span class="c1"># Plotting the imaginary parts</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;OmegaVec&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;FTDipoleX_Im&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;FTDipoleX_Im&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;OmegaVec&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;FTDipoleY_Im&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;FTDipoleY_Im&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;OmegaVec&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;FTDipoleZ_Im&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;FTDipoleZ_Im&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Imaginary Components of FT Dipoles vs OmegaVec&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;OmegaVec&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Imaginary Part of FT Dipole&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

    <span class="c1"># Plotting the average FT dipole strength</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="c1"># plt.plot(omega_vec, average_ft_dipole, label=&#39;Average FT Dipole Magnitude&#39;, color=&#39;black&#39;)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;OmegaVec&#39;</span><span class="p">],</span> <span class="n">average_ft_dipole</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Average FT Dipole Magnitude&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Average FT Dipole Magnitude vs OmegaVec&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;OmegaVec&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Average FT Dipole Magnitude&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="c1"># plt.show()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">study_directory</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">experiment_directory</span><span class="si">}</span><span class="s1">/Dipole/DipoleFT_vs_OmegaVec.png&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">try_color_maps</span><span class="p">:</span>
        <span class="n">color_maps</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;viridis&#39;</span><span class="p">,</span> <span class="s1">&#39;seismic&#39;</span><span class="p">,</span> <span class="s1">&#39;inferno&#39;</span><span class="p">,</span> <span class="s1">&#39;twilight_shifted&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">color_maps</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;seismic&#39;</span><span class="p">]</span>
    <span class="c1"># Create a plot per Atom</span>
    <span class="k">for</span> <span class="n">color_map</span> <span class="ow">in</span> <span class="n">color_maps</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Alternative Plots for Understanding the Data (Plotly Contour Maps need to be 2D not 1D so we create mesh)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Creating a grid for contour plot</span>
        <span class="n">ct2_grid</span><span class="p">,</span> <span class="n">omega_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;central_time_2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">(),</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;OmegaVec&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">(),</span> <span class="n">indexing</span><span class="o">=</span><span class="s1">&#39;ij&#39;</span><span class="p">)</span>

        <span class="c1"># Reshaping the data to match the grid</span>
        <span class="n">ft_dipole_x_re_grid</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;FTDipoleX_Re&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">ct2_grid</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">ft_dipole_x_im_grid</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;FTDipoleX_Im&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">ct2_grid</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">ft_dipole_y_re_grid</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;FTDipoleY_Re&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">ct2_grid</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">ft_dipole_y_im_grid</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;FTDipoleY_Im&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">ct2_grid</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">ft_dipole_z_re_grid</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;FTDipoleZ_Re&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">ct2_grid</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">ft_dipole_z_im_grid</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;FTDipoleZ_Im&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">ct2_grid</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

        <span class="c1"># Calculating the Z value for the contour plot (average FT dipole magnitude)</span>
        <span class="n">average_ft_dipole_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">ft_dipole_x_re_grid</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">ft_dipole_x_im_grid</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span>
                                          <span class="n">ft_dipole_y_re_grid</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">ft_dipole_y_im_grid</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span>
                                          <span class="n">ft_dipole_z_re_grid</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">ft_dipole_z_im_grid</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)</span>

        <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">24</span><span class="p">,</span> <span class="mi">18</span><span class="p">))</span>

        <span class="c1"># Dynamic Range Adjustment using different percentiles</span>
        <span class="n">norm_1_99</span> <span class="o">=</span> <span class="n">colors</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span>
            <span class="n">vmin</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">average_ft_dipole_grid</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">),</span>
            <span class="n">vmax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">average_ft_dipole_grid</span><span class="p">,</span> <span class="mf">99.9</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">ct2_grid</span><span class="p">,</span> <span class="n">omega_grid</span><span class="p">,</span> <span class="n">average_ft_dipole_grid</span><span class="p">,</span>
                                         <span class="n">levels</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">color_map</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm_1_99</span><span class="p">),</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Percentile (0.01</span><span class="si">% - 99.9%</span><span class="s1">) Adjusted Contour Map&#39;</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Central Time 2&#39;</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;OmegaVec&#39;</span><span class="p">)</span>
        <span class="c1">#</span>
        <span class="n">norm_5_95</span> <span class="o">=</span> <span class="n">colors</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span>
            <span class="n">vmin</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">average_ft_dipole_grid</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
            <span class="n">vmax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">average_ft_dipole_grid</span><span class="p">,</span> <span class="mi">99</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">ct2_grid</span><span class="p">,</span> <span class="n">omega_grid</span><span class="p">,</span> <span class="n">average_ft_dipole_grid</span><span class="p">,</span>
                                         <span class="n">levels</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">color_map</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm_5_95</span><span class="p">),</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Percentile (1</span><span class="si">% - 99%</span><span class="s1">) Adjusted Contour Map&#39;</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Central Time 2&#39;</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;OmegaVec&#39;</span><span class="p">)</span>

        <span class="c1"># Logarithmic Scaling</span>
        <span class="n">log_scaled_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">average_ft_dipole_grid</span><span class="p">))</span>  <span class="c1"># Adding 1 to avoid log(0)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">ct2_grid</span><span class="p">,</span> <span class="n">omega_grid</span><span class="p">,</span> <span class="n">log_scaled_data</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">color_map</span><span class="p">),</span>
                     <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Logarithmic Scaled Data Contour Map&#39;</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Central Time 2&#39;</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;OmegaVec&#39;</span><span class="p">)</span>

        <span class="c1"># Derivative Plots</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">ct2_grid</span><span class="p">,</span> <span class="n">omega_grid</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span><span class="n">average_ft_dipole_grid</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
                                         <span class="n">levels</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">color_map</span><span class="p">),</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;First Derivative of Data&#39;</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Central Time 2&#39;</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;OmegaVec&#39;</span><span class="p">)</span>

        <span class="c1"># Smoothing (Gaussian Filter) and Filtering</span>
        <span class="n">smoothed_data</span> <span class="o">=</span> <span class="n">gaussian_filter</span><span class="p">(</span><span class="n">average_ft_dipole_grid</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># Applying a Gaussian filter</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">ct2_grid</span><span class="p">,</span> <span class="n">omega_grid</span><span class="p">,</span> <span class="n">smoothed_data</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">color_map</span><span class="p">),</span>
                     <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Smoothed Data Contour Map&#39;</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Central Time 2&#39;</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;OmegaVec&#39;</span><span class="p">)</span>

        <span class="c1"># Derivative Plots</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">ct2_grid</span><span class="p">,</span> <span class="n">omega_grid</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span><span class="n">smoothed_data</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">levels</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
                                         <span class="n">cmap</span><span class="o">=</span><span class="n">color_map</span><span class="p">),</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;First Derivative of Smoothed Data&#39;</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Central Time 2&#39;</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;OmegaVec&#39;</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="c1"># plt.show()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">study_directory</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">experiment_directory</span><span class="si">}</span><span class="s1">/Dipole/DipoleFT_ALL_Alternative_</span><span class="si">{</span><span class="n">color_map</span><span class="si">}</span><span class="s1">_Plots.png&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="plot_ft_all_atomic_dipoles_v_time"><a class="viewcode-back" href="../../../post_processing.plotting_module.html#post_processing.plotting_module.plot_ft_all_atomic_dipoles_v_time">[docs]</a><span class="k">def</span> <span class="nf">plot_ft_all_atomic_dipoles_v_time</span><span class="p">(</span><span class="n">study_directory</span><span class="p">,</span> <span class="n">experiment_directory</span><span class="p">,</span> <span class="n">dephasing_factor</span><span class="p">,</span> <span class="n">relaxation_factor</span><span class="p">,</span>
                                      <span class="n">pump_settings</span><span class="p">,</span> <span class="n">probe_settings</span><span class="p">,</span> <span class="n">charge_migration_ft_settings</span><span class="p">,</span>
                                      <span class="n">xyz_geometry_path</span><span class="p">,</span> <span class="n">try_color_maps</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function plots the Fourier Transform of the atomic charges/dipoles vs time</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># &quot;number_of_pulses&quot;, &quot;central_time_1&quot;, &quot;carrier_frequency_1&quot;, &quot;fwhm_1&quot;, &quot;carrier_envelope_phase_1&quot;,</span>
    <span class="c1">#     &quot;intensity_1&quot;, &quot;amplitude_1&quot;, &quot;period_1&quot;, &quot;central_time_2&quot;, &quot;carrier_frequency_2&quot;, &quot;fwhm_2&quot;,</span>
    <span class="c1">#     &quot;carrier_envelope_phase_2&quot;, &quot;intensity_2&quot;, &quot;amplitude_...&quot;, &quot;period_...&quot;, &quot;iOmega&quot;, &quot;OmegaVec&quot;,</span>
    <span class="c1">#     &quot;Atom_O_FTChargeX_Re&quot;, &quot;Atom_O_FTChargeX_Im&quot;, &quot;Atom_O_FTChargeY_Re&quot;, &quot;Atom_O_FTChargeY_Im&quot;,</span>
    <span class="c1">#     &quot;Atom_O_FTChargeZ_Re&quot;, &quot;Atom_O_FTChargeZ_Im&quot;, &quot;Atom_N_FTChargeX_Re&quot;, &quot;Atom_N_FTChargeX_Im&quot;,</span>
    <span class="c1">#     &quot;Atom_N_FTChargeY_Re&quot;, &quot;Atom_N_FTChargeY_Im&quot;, &quot;Atom_N_FTChargeZ_Re&quot;, &quot;Atom_N_FTChargeZ_Im&quot;,</span>
    <span class="c1">#     &quot;Atom_C_FTChargeX_Re&quot;, &quot;Atom_C_FTChargeX_Im&quot;, &quot;Atom_C_FTCharge...&quot;</span>

    <span class="c1"># Read the XYZ file to get the number of atoms, the name of the atom and the atom names</span>
    <span class="c1"># (this is the order in which the atoms are listed in the CSV file)</span>
    <span class="n">xyz_file_content</span> <span class="o">=</span> <span class="n">read_xyz</span><span class="p">(</span><span class="n">xyz_geometry_path</span><span class="p">)</span>
    <span class="n">ATOMIC_FT_COL_NAMES</span> <span class="o">=</span> <span class="n">__generate_atomic_FTcharge_column_names</span><span class="p">(</span>
        <span class="n">xyz_geometry_path</span><span class="p">)</span>  <span class="c1"># Rereads file but is intended for modularity and readability</span>
    <span class="n">R_el_bc</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">study_directory</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">experiment_directory</span><span class="si">}</span><span class="s1">/R_el_bc.csv&#39;</span><span class="p">)</span>

    <span class="n">FILE_PATH</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">study_directory</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">experiment_directory</span><span class="si">}</span><span class="s1">/AtomicCharge/AtomicChargeFT_ALL.csv&#39;</span>

    <span class="c1"># Pump Settings</span>
    <span class="n">type_of_pulse_pump</span> <span class="o">=</span> <span class="n">pump_settings</span><span class="p">[</span><span class="s1">&#39;typeofpulse&#39;</span><span class="p">]</span>
    <span class="n">start_time</span> <span class="o">=</span> <span class="n">pump_settings</span><span class="p">[</span><span class="s1">&#39;starttime&#39;</span><span class="p">]</span>
    <span class="n">pump_central_frequency</span> <span class="o">=</span> <span class="n">pump_settings</span><span class="p">[</span><span class="s1">&#39;pumpcentralfrequency&#39;</span><span class="p">]</span>
    <span class="n">pump_periods</span> <span class="o">=</span> <span class="n">pump_settings</span><span class="p">[</span><span class="s1">&#39;pumpperiods&#39;</span><span class="p">]</span>
    <span class="n">pump_phase</span> <span class="o">=</span> <span class="n">pump_settings</span><span class="p">[</span><span class="s1">&#39;pumpphase&#39;</span><span class="p">]</span>
    <span class="n">pump_intensity</span> <span class="o">=</span> <span class="n">pump_settings</span><span class="p">[</span><span class="s1">&#39;pumpintensity&#39;</span><span class="p">]</span>
    <span class="n">pump_polarization</span> <span class="o">=</span> <span class="n">pump_settings</span><span class="p">[</span><span class="s1">&#39;pumppolarization&#39;</span><span class="p">]</span>

    <span class="c1"># Probe Settings</span>
    <span class="n">type_of_pulse_probe</span> <span class="o">=</span> <span class="n">probe_settings</span><span class="p">[</span><span class="s1">&#39;typeofpulse&#39;</span><span class="p">]</span>
    <span class="n">time_delay_start</span> <span class="o">=</span> <span class="n">probe_settings</span><span class="p">[</span><span class="s1">&#39;timedelaystart&#39;</span><span class="p">]</span>
    <span class="n">time_delay_stop</span> <span class="o">=</span> <span class="n">probe_settings</span><span class="p">[</span><span class="s1">&#39;timedelaystop&#39;</span><span class="p">]</span>
    <span class="n">number_of_pp</span> <span class="o">=</span> <span class="n">probe_settings</span><span class="p">[</span><span class="s1">&#39;numberofpp&#39;</span><span class="p">]</span>
    <span class="n">time_Delay_weight_factor</span> <span class="o">=</span> <span class="n">probe_settings</span><span class="p">[</span><span class="s1">&#39;timedelayweightfactor&#39;</span><span class="p">]</span>
    <span class="n">probe_central_frequency</span> <span class="o">=</span> <span class="n">probe_settings</span><span class="p">[</span><span class="s1">&#39;probecentralfrequency&#39;</span><span class="p">]</span>
    <span class="n">probe_periods</span> <span class="o">=</span> <span class="n">probe_settings</span><span class="p">[</span><span class="s1">&#39;probeperiods&#39;</span><span class="p">]</span>
    <span class="n">probe_phase</span> <span class="o">=</span> <span class="n">probe_settings</span><span class="p">[</span><span class="s1">&#39;probephase&#39;</span><span class="p">]</span>
    <span class="n">probe_intensity</span> <span class="o">=</span> <span class="n">probe_settings</span><span class="p">[</span><span class="s1">&#39;probeintensity&#39;</span><span class="p">]</span>
    <span class="n">probe_polarization</span> <span class="o">=</span> <span class="n">probe_settings</span><span class="p">[</span><span class="s1">&#39;probepolarization&#39;</span><span class="p">]</span>

    <span class="c1"># Charge Migration Settings</span>
    <span class="n">ft_time_step</span> <span class="o">=</span> <span class="n">charge_migration_ft_settings</span><span class="p">[</span><span class="s1">&#39;fttimestep&#39;</span><span class="p">]</span>
    <span class="n">ft_width_step</span> <span class="o">=</span> <span class="n">charge_migration_ft_settings</span><span class="p">[</span><span class="s1">&#39;ftwidthstep&#39;</span><span class="p">]</span>

    <span class="c1"># Lets plot the Spectra FT Dipolar Reponse vs Time (t)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">FILE_PATH</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Length of data: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ATOMIC_FT_COL_NAMES</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1"> not in data.columns&#39;</span><span class="p">)</span>

    <span class="c1"># Plotting the real and imaginary parts of the charge components for each atom</span>
    <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">FILE_PATH</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">component</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="s1">&#39;X_Re&#39;</span><span class="p">,</span> <span class="s1">&#39;X_Im&#39;</span><span class="p">,</span> <span class="s1">&#39;Y_Re&#39;</span><span class="p">,</span> <span class="s1">&#39;Y_Im&#39;</span><span class="p">,</span> <span class="s1">&#39;Z_Re&#39;</span><span class="p">,</span> <span class="s1">&#39;Z_Im&#39;</span><span class="p">]):</span>
        <span class="n">columns_to_plot</span> <span class="o">=</span> <span class="p">[</span><span class="n">col_name</span> <span class="k">for</span> <span class="n">col_name</span> <span class="ow">in</span> <span class="n">ATOMIC_FT_COL_NAMES</span> <span class="k">if</span> <span class="n">component</span> <span class="ow">in</span> <span class="n">col_name</span><span class="p">]</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">col_name</span> <span class="ow">in</span> <span class="n">columns_to_plot</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;central_time_2&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="n">col_name</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">col_name</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;ChargeFT</span><span class="si">{</span><span class="n">component</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;central_time_2&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;ChargeFT</span><span class="si">{</span><span class="n">component</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="c1"># plt.show()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span>
        <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">study_directory</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">experiment_directory</span><span class="si">}</span><span class="s1">/AtomicCharge/AtomicChargeFT_ALL_Components_vs_central_time_2.png&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>

    <span class="c1"># Calculating the average of the squared magnitudes of the FT dipole components</span>
    <span class="n">sum_of_squares</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ATOMIC_FT_COL_NAMES</span><span class="p">:</span>
        <span class="n">sum_of_squares</span> <span class="o">+=</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span>
    <span class="n">average_ft_atomic_dipole</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">sum_of_squares</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)</span>

    <span class="c1"># Creating an interactive plot using Plotly</span>
    <span class="n">_plot_contour_map</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;central_time_2&#39;</span><span class="p">],</span>
                      <span class="n">y</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;OmegaVec&#39;</span><span class="p">],</span>
                      <span class="n">z</span><span class="o">=</span><span class="n">average_ft_atomic_dipole</span><span class="p">,</span>
                      <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Contour Map of Average FT Dipole Magnitude</span><span class="se">\n</span><span class="s1">&#39;</span>
                            <span class="sa">f</span><span class="s1">&#39;AtomicChargeFT_ALL.csv</span><span class="se">\n</span><span class="s1">&#39;</span>
                            <span class="sa">f</span><span class="s1">&#39;Pump Settings:  </span><span class="si">{</span><span class="n">pump_central_frequency</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="n">pump_periods</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="n">pump_phase</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="n">pump_intensity</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="n">pump_polarization</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span>
                            <span class="sa">f</span><span class="s1">&#39;Probe Settings:  </span><span class="si">{</span><span class="n">probe_central_frequency</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="n">probe_periods</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="n">probe_phase</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="n">probe_intensity</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="n">probe_polarization</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span>
                            <span class="sa">f</span><span class="s1">&#39;Dephasing Factor: </span><span class="si">{</span><span class="n">dephasing_factor</span><span class="si">}</span><span class="s1">, Relaxation Factor: </span><span class="si">{</span><span class="n">relaxation_factor</span><span class="si">}</span><span class="s1">&#39;</span>
                            <span class="sa">f</span><span class="s1">&#39;FT Time Step: </span><span class="si">{</span><span class="n">ft_time_step</span><span class="si">}</span><span class="s1">, FT Width Step: </span><span class="si">{</span><span class="n">ft_width_step</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
                      <span class="n">x_label</span><span class="o">=</span><span class="s1">&#39;Central Time 2 - Probe (tau)&#39;</span><span class="p">,</span>
                      <span class="n">y_label</span><span class="o">=</span><span class="s1">&#39;OmegaVec&#39;</span><span class="p">,</span>
                      <span class="n">output_file</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">study_directory</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">experiment_directory</span><span class="si">}</span><span class="s1">/AtomicCharge/AtomicChargeFT_ALL_Contour.html&#39;</span><span class="p">)</span>

    <span class="c1"># Plotting</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

    <span class="c1"># Plotting the real parts</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ATOMIC_FT_COL_NAMES</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1"> not in data.columns&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;_Re&#39;</span> <span class="ow">in</span> <span class="n">i</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;OmegaVec&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">i</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Real Components of FT Atomic Charges vs OmegaVec&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;OmegaVec&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Real Part of FT Atomic Charge&#39;</span><span class="p">)</span>

    <span class="c1"># Plotting the imaginary parts</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ATOMIC_FT_COL_NAMES</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;_Im&#39;</span> <span class="ow">in</span> <span class="n">i</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;OmegaVec&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">i</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Imaginary Components of FT Atomic Charges vs OmegaVec&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;OmegaVec&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Imaginary Part of FT Atomic Charge&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span>
        <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.05</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
        <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">,</span>
        <span class="n">borderaxespad</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
        <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Legend&#39;</span><span class="p">,</span>
        <span class="n">title_fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
        <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
        <span class="n">labelspacing</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
        <span class="n">fancybox</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">shadow</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">ncol</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">framealpha</span><span class="o">=</span><span class="mf">0.5</span>
    <span class="p">)</span>

    <span class="c1"># Plotting the average FT dipole strength</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="c1"># plt.plot(omega_vec, average_ft_dipole, label=&#39;Average FT Dipole Magnitude&#39;, color=&#39;black&#39;)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;OmegaVec&#39;</span><span class="p">],</span> <span class="n">average_ft_atomic_dipole</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Average FT Atomic Dipole Magnitude&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Average FT Atomic Dipole Magnitude vs OmegaVec&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;OmegaVec&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Average FT Atomic Dipole Magnitude&#39;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="c1"># plt.show()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">study_directory</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">experiment_directory</span><span class="si">}</span><span class="s1">/AtomicCharge/AtomicChargeFT_vs_OmegaVec.png&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>

    <span class="c1">############</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Alternative Plots for Understanding the Data (Plotly Contour Maps need to be 2D not 1D so we create mesh)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Creating a grid for contour plot</span>
    <span class="n">ct2_grid</span><span class="p">,</span> <span class="n">omega_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;central_time_2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">(),</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;OmegaVec&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">(),</span> <span class="n">indexing</span><span class="o">=</span><span class="s1">&#39;ij&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">try_color_maps</span><span class="p">:</span>
        <span class="n">color_maps</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;viridis&#39;</span><span class="p">,</span> <span class="s1">&#39;seismic&#39;</span><span class="p">,</span> <span class="s1">&#39;inferno&#39;</span><span class="p">,</span> <span class="s1">&#39;twilight_shifted&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">color_maps</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;seismic&#39;</span><span class="p">]</span>
    <span class="c1"># Create a plot per Atom</span>
    <span class="k">for</span> <span class="n">color_map</span> <span class="ow">in</span> <span class="n">color_maps</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">_atom_name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">xyz_file_content</span><span class="p">[</span><span class="s1">&#39;atoms&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">24</span><span class="p">,</span> <span class="mi">18</span><span class="p">))</span>
            <span class="c1"># Set the title for the plot</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">FILE_PATH</span><span class="p">)</span>
            <span class="n">split_atom_name</span> <span class="o">=</span> <span class="n">_atom_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">split_atom_name</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">atom_name</span> <span class="o">=</span> <span class="n">_atom_name</span>
                <span class="n">atom_subscript</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">split_atom_name</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">atom_name</span> <span class="o">=</span> <span class="n">split_atom_name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">atom_subscript</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;.</span><span class="si">{</span><span class="n">split_atom_name</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Atom name </span><span class="si">{</span><span class="n">_atom_name</span><span class="si">}</span><span class="s1"> is not valid&#39;</span><span class="p">)</span>

            <span class="c1"># Reshaping the data to match the grid</span>
            <span class="n">atomic_ft_dipole_x_re_grid</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;Atom_</span><span class="si">{</span><span class="n">atom_name</span><span class="si">}</span><span class="s1">_FTChargeX_Re</span><span class="si">{</span><span class="n">atom_subscript</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span>
                <span class="n">ct2_grid</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
            <span class="n">atomic_ft_dipole_x_im_grid</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;Atom_</span><span class="si">{</span><span class="n">atom_name</span><span class="si">}</span><span class="s1">_FTChargeX_Im</span><span class="si">{</span><span class="n">atom_subscript</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span>
                <span class="n">ct2_grid</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
            <span class="n">atomic_ft_dipole_y_re_grid</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;Atom_</span><span class="si">{</span><span class="n">atom_name</span><span class="si">}</span><span class="s1">_FTChargeY_Re</span><span class="si">{</span><span class="n">atom_subscript</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span>
                <span class="n">ct2_grid</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
            <span class="n">atomic_ft_dipole_y_im_grid</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;Atom_</span><span class="si">{</span><span class="n">atom_name</span><span class="si">}</span><span class="s1">_FTChargeY_Im</span><span class="si">{</span><span class="n">atom_subscript</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span>
                <span class="n">ct2_grid</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
            <span class="n">atomic_ft_dipole_z_re_grid</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;Atom_</span><span class="si">{</span><span class="n">atom_name</span><span class="si">}</span><span class="s1">_FTChargeZ_Re</span><span class="si">{</span><span class="n">atom_subscript</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span>
                <span class="n">ct2_grid</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
            <span class="n">atomic_ft_dipole_z_im_grid</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;Atom_</span><span class="si">{</span><span class="n">atom_name</span><span class="si">}</span><span class="s1">_FTChargeZ_Im</span><span class="si">{</span><span class="n">atom_subscript</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span>
                <span class="n">ct2_grid</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

            <span class="c1"># Calculating the Z value for the contour plot (average FT dipole magnitude)</span>
            <span class="n">average_ft_atomic_dipole_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">atomic_ft_dipole_x_re_grid</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">atomic_ft_dipole_x_im_grid</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span>
                                                     <span class="n">atomic_ft_dipole_y_re_grid</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">atomic_ft_dipole_y_im_grid</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span>
                                                     <span class="n">atomic_ft_dipole_z_re_grid</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">atomic_ft_dipole_z_im_grid</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)</span>

            <span class="c1"># Dynamic Range Adjustment using different percentiles</span>
            <span class="n">norm_1_99</span> <span class="o">=</span> <span class="n">colors</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span>
                <span class="n">vmin</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">average_ft_atomic_dipole_grid</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">),</span>
                <span class="n">vmax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">average_ft_atomic_dipole_grid</span><span class="p">,</span> <span class="mf">99.9</span><span class="p">))</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">ct2_grid</span><span class="p">,</span> <span class="n">omega_grid</span><span class="p">,</span> <span class="n">average_ft_atomic_dipole_grid</span><span class="p">,</span>
                                             <span class="n">levels</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">color_map</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm_1_99</span><span class="p">),</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
            <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;Percentile (0.01% - 99.9%) Adjusted Contour Map of Atom </span><span class="si">{</span><span class="n">_atom_name</span><span class="si">}</span><span class="s1"> FT Charge Averaged&#39;</span><span class="p">)</span>
            <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Central Time 2&#39;</span><span class="p">)</span>
            <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;OmegaVec&#39;</span><span class="p">)</span>

            <span class="c1">#</span>
            <span class="n">norm_5_95</span> <span class="o">=</span> <span class="n">colors</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span>
                <span class="n">vmin</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">average_ft_atomic_dipole_grid</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
                <span class="n">vmax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">average_ft_atomic_dipole_grid</span><span class="p">,</span> <span class="mi">95</span><span class="p">))</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">ct2_grid</span><span class="p">,</span> <span class="n">omega_grid</span><span class="p">,</span> <span class="n">average_ft_atomic_dipole_grid</span><span class="p">,</span>
                                             <span class="n">levels</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">color_map</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm_5_95</span><span class="p">),</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
            <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Percentile (1% - 99%) Adjusted Contour Map of Atom </span><span class="si">{</span><span class="n">_atom_name</span><span class="si">}</span><span class="s1"> FT Charge Averaged&#39;</span><span class="p">)</span>
            <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Central Time 2&#39;</span><span class="p">)</span>
            <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;OmegaVec&#39;</span><span class="p">)</span>

            <span class="c1"># Logarithmic Scaling</span>
            <span class="n">log_scaled_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">average_ft_atomic_dipole_grid</span><span class="p">))</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">ct2_grid</span><span class="p">,</span> <span class="n">omega_grid</span><span class="p">,</span> <span class="n">log_scaled_data</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">color_map</span><span class="p">),</span>
                         <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
            <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Logarithmic Scaled Data Contour Map of Atom </span><span class="si">{</span><span class="n">_atom_name</span><span class="si">}</span><span class="s1"> FT Charge Averaged&#39;</span><span class="p">)</span>
            <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Central Time 2&#39;</span><span class="p">)</span>
            <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;OmegaVec&#39;</span><span class="p">)</span>

            <span class="c1"># Derivative Plots</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">ct2_grid</span><span class="p">,</span> <span class="n">omega_grid</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span><span class="n">average_ft_atomic_dipole_grid</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
                                             <span class="n">levels</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">color_map</span><span class="p">),</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
            <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;First Derivative of Data of Atom </span><span class="si">{</span><span class="n">_atom_name</span><span class="si">}</span><span class="s1"> FT Charge Averaged&#39;</span><span class="p">)</span>
            <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Central Time 2&#39;</span><span class="p">)</span>
            <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;OmegaVec&#39;</span><span class="p">)</span>

            <span class="c1"># Smoothing (Gaussian Filter) and Filtering</span>
            <span class="n">smoothed_data</span> <span class="o">=</span> <span class="n">gaussian_filter</span><span class="p">(</span><span class="n">average_ft_atomic_dipole_grid</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># Applying a Gaussian filter</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">ct2_grid</span><span class="p">,</span> <span class="n">omega_grid</span><span class="p">,</span> <span class="n">smoothed_data</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">color_map</span><span class="p">),</span>
                         <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
            <span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Smoothed Data Contour Map of Atom </span><span class="si">{</span><span class="n">_atom_name</span><span class="si">}</span><span class="s1"> FT Charge Averaged&#39;</span><span class="p">)</span>
            <span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Central Time 2&#39;</span><span class="p">)</span>

            <span class="c1"># Derivative Plots</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">ct2_grid</span><span class="p">,</span> <span class="n">omega_grid</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span><span class="n">smoothed_data</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">levels</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
                                             <span class="n">cmap</span><span class="o">=</span><span class="n">color_map</span><span class="p">),</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
            <span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;First Derivative of Smoothed Data of Atom </span><span class="si">{</span><span class="n">_atom_name</span><span class="si">}</span><span class="s1"> FT Charge Averaged&#39;</span><span class="p">)</span>
            <span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Central Time 2&#39;</span><span class="p">)</span>
            <span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;OmegaVec&#39;</span><span class="p">)</span>

            <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
            <span class="c1"># plt.show()</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">study_directory</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">experiment_directory</span><span class="si">}</span><span class="s1">/AtomicCharge/AtomicChargeFT_ALL_Alternative_</span><span class="si">{</span><span class="n">color_map</span><span class="si">}</span><span class="s1">_Plots_</span><span class="si">{</span><span class="n">_atom_name</span><span class="si">}</span><span class="s1">.png&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">)</span></div>


<span class="sd">&#39;&#39;&#39;Dipolar 2D Spectra&#39;&#39;&#39;</span>


<div class="viewcode-block" id="plot_2d_spectrum"><a class="viewcode-back" href="../../../post_processing.plotting_module.html#post_processing.plotting_module.plot_2d_spectrum">[docs]</a><span class="k">def</span> <span class="nf">plot_2d_spectrum</span><span class="p">(</span><span class="n">study_directory</span><span class="p">,</span> <span class="n">experiment_directory</span><span class="p">,</span> <span class="n">dephasing_factor</span><span class="p">,</span> <span class="n">relaxation_factor</span><span class="p">,</span>
                     <span class="n">pump_settings</span><span class="p">,</span> <span class="n">probe_settings</span><span class="p">,</span> <span class="n">charge_migration_ft_settings</span><span class="p">,</span> <span class="n">match_scales</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="n">OMEGA_TAUOMEGA_FILE_NAMES</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;Dipole/DipoleFT_ww.csv&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Dipole/DipoleFT_ww_reconstructed.csv&#39;</span><span class="p">,</span>
    <span class="p">]</span>
    <span class="n">OMEGA_TAUOMEGA_FILE_PATHS</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">study_directory</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">experiment_directory</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">file_name</span> <span class="ow">in</span>
                                 <span class="n">OMEGA_TAUOMEGA_FILE_NAMES</span><span class="p">]</span>

    <span class="n">length_of_data_to_match</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">FEATURES_COL_NAMES</span> <span class="o">=</span> <span class="p">[</span>  <span class="c1"># Todo do per polarization images too</span>
        <span class="s1">&#39;2DDipoleX_Re&#39;</span><span class="p">,</span>
        <span class="s1">&#39;2DDipoleX_Im&#39;</span><span class="p">,</span>
        <span class="s1">&#39;2DDipoleY_Re&#39;</span><span class="p">,</span>
        <span class="s1">&#39;2DDipoleY_Im&#39;</span><span class="p">,</span>
        <span class="s1">&#39;2DDipoleZ_Re&#39;</span><span class="p">,</span>
        <span class="s1">&#39;2DDipoleZ_Im&#39;</span>
    <span class="p">]</span>

    <span class="n">ft_time_step</span> <span class="o">=</span> <span class="n">charge_migration_ft_settings</span><span class="p">[</span><span class="s1">&#39;fttimestep&#39;</span><span class="p">]</span>
    <span class="n">ft_width_step</span> <span class="o">=</span> <span class="n">charge_migration_ft_settings</span><span class="p">[</span><span class="s1">&#39;ftwidthstep&#39;</span><span class="p">]</span>

    <span class="n">_zmax</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">_zmin</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">for</span> <span class="n">file_path</span> <span class="ow">in</span> <span class="n">OMEGA_TAUOMEGA_FILE_PATHS</span><span class="p">:</span>
        <span class="c1"># Load the CSV file</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Plotting </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">length_of_data_to_match</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">length_of_data_to_match</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">length_of_data_to_match</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span>
                <span class="n">data</span><span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;Length of </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s1"> is not the same as the previous file&#39;</span>

        <span class="c1"># Displaying the first few rows of the file to understand its structure</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Length of data: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="c1"># Calculating the average of all polarizations</span>
        <span class="n">data</span><span class="p">[</span><span class="s1">&#39;AveragedDensity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">FEATURES_COL_NAMES</span><span class="p">)</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.5</span>
        <span class="c1"># data[&#39;AveragedDensity&#39;] = sum(data[col] ** 2 for col in FEATURES_COL_NAMES)</span>

        <span class="c1"># Adding the averaged density to the DataFrame</span>
        <span class="k">if</span> <span class="s1">&#39;DipoleFT_ww_reconstructed&#39;</span> <span class="ow">in</span> <span class="n">file_path</span><span class="p">:</span>
            <span class="c1"># FIXME Flip accross the frequency axis but keep the same index (idk why this bug exists)</span>
            <span class="n">data</span><span class="p">[</span><span class="s1">&#39;AveragedDensity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;AveragedDensity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                                                <span class="n">index</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;AveragedDensity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

        <span class="c1"># Plotting the contour map</span>
        <span class="k">if</span> <span class="n">match_scales</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">_zmax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">_zmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;AveragedDensity&#39;</span><span class="p">],</span> <span class="mf">99.5</span><span class="p">)</span>
                <span class="n">_zmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;AveragedDensity&#39;</span><span class="p">],</span> <span class="mf">0.01</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_zmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;AveragedDensity&#39;</span><span class="p">],</span> <span class="mf">99.9</span><span class="p">)</span>
            <span class="n">_zmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;AveragedDensity&#39;</span><span class="p">],</span> <span class="mf">0.01</span><span class="p">)</span>

        <span class="n">_plot_contour_map</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;TauOmegaVec&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;OmegaVec&#39;</span><span class="p">],</span>
            <span class="n">y</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;OmegaVec&#39;</span><span class="p">],</span>
            <span class="n">z</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;AveragedDensity&#39;</span><span class="p">],</span>
            <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Contour Map of Average FT Dipole (Pure-Absorption)</span><span class="se">\n</span><span class="s1">&#39;</span>
                  <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span>
                  <span class="sa">f</span><span class="s1">&#39;Pump Settings:  </span><span class="si">{</span><span class="n">pump_settings</span><span class="p">[</span><span class="s2">&quot;pumpcentralfrequency&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="n">pump_settings</span><span class="p">[</span><span class="s2">&quot;pumpperiods&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="n">pump_settings</span><span class="p">[</span><span class="s2">&quot;pumpphase&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="n">pump_settings</span><span class="p">[</span><span class="s2">&quot;pumpintensity&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="n">pump_settings</span><span class="p">[</span><span class="s2">&quot;pumppolarization&quot;</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span>
                  <span class="sa">f</span><span class="s1">&#39;Probe Settings:  </span><span class="si">{</span><span class="n">probe_settings</span><span class="p">[</span><span class="s2">&quot;probecentralfrequency&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="n">probe_settings</span><span class="p">[</span><span class="s2">&quot;probeperiods&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="n">probe_settings</span><span class="p">[</span><span class="s2">&quot;probephase&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="n">probe_settings</span><span class="p">[</span><span class="s2">&quot;probeintensity&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="n">probe_settings</span><span class="p">[</span><span class="s2">&quot;probepolarization&quot;</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span>
                  <span class="sa">f</span><span class="s1">&#39;FT Time Step: </span><span class="si">{</span><span class="n">ft_time_step</span><span class="si">}</span><span class="s1">, FT Width Step: </span><span class="si">{</span><span class="n">ft_width_step</span><span class="si">}</span><span class="s1">, Dephasing Factor: </span><span class="si">{</span><span class="n">dephasing_factor</span><span class="si">}</span><span class="s1">, Relaxation Factor: </span><span class="si">{</span><span class="n">relaxation_factor</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
            <span class="n">x_label</span><span class="o">=</span><span class="s1">&#39;OmegaVec + TauOmegaVec&#39;</span><span class="p">,</span>
            <span class="n">y_label</span><span class="o">=</span><span class="s1">&#39;OmegaVec&#39;</span><span class="p">,</span>
            <span class="n">output_file</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.csv&#39;</span><span class="p">,</span> <span class="s1">&#39;.html&#39;</span><span class="p">),</span>
            <span class="n">add_diagonal_line</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">contour_kwargs</span><span class="o">=</span><span class="p">{</span>
                <span class="s1">&#39;colorscale&#39;</span><span class="p">:</span> <span class="s1">&#39;Viridis&#39;</span><span class="p">,</span>
                <span class="s1">&#39;contours_coloring&#39;</span><span class="p">:</span> <span class="s1">&#39;heatmap&#39;</span><span class="p">,</span>
                <span class="s1">&#39;zmin&#39;</span><span class="p">:</span> <span class="n">_zmin</span><span class="p">,</span>
                <span class="s1">&#39;zmax&#39;</span><span class="p">:</span> <span class="n">_zmax</span>
            <span class="p">}</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="plot_2d_spectrum_peak_analysis"><a class="viewcode-back" href="../../../post_processing.plotting_module.html#post_processing.plotting_module.plot_2d_spectrum_peak_analysis">[docs]</a><span class="k">def</span> <span class="nf">plot_2d_spectrum_peak_analysis</span><span class="p">(</span><span class="n">study_directory</span><span class="p">,</span> <span class="n">experiment_directory</span><span class="p">):</span>
    <span class="n">OMEGA_TAUOMEGA_FILE_NAMES</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;Dipole/DipoleFT_ww.csv&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Dipole/DipoleFT_ww_reconstructed.csv&#39;</span><span class="p">,</span>
    <span class="p">]</span>
    <span class="n">OMEGA_TAUOMEGA_FILE_PATHS</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">study_directory</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">experiment_directory</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">file_name</span> <span class="ow">in</span>
                                 <span class="n">OMEGA_TAUOMEGA_FILE_NAMES</span><span class="p">]</span>

    <span class="n">length_of_data_to_match</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">FEATURES_COL_NAMES</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;2DDipoleX_Re&#39;</span><span class="p">,</span>
        <span class="s1">&#39;2DDipoleX_Im&#39;</span><span class="p">,</span>
        <span class="s1">&#39;2DDipoleY_Re&#39;</span><span class="p">,</span>
        <span class="s1">&#39;2DDipoleY_Im&#39;</span><span class="p">,</span>
        <span class="s1">&#39;2DDipoleZ_Re&#39;</span><span class="p">,</span>
        <span class="s1">&#39;2DDipoleZ_Im&#39;</span>
    <span class="p">]</span>

    <span class="k">for</span> <span class="n">file_path</span> <span class="ow">in</span> <span class="n">OMEGA_TAUOMEGA_FILE_PATHS</span><span class="p">:</span>
        <span class="c1"># Load the CSV file</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Plotting </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">length_of_data_to_match</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">length_of_data_to_match</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">length_of_data_to_match</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span>
                <span class="n">data</span><span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;Length of </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s1"> is not the same as the previous file&#39;</span>

        <span class="c1"># Displaying the first few rows of the file to understand its structure</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Length of data: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="c1"># Calculating the average of all polarizations</span>
        <span class="c1"># data[&#39;AveragedDensity&#39;] = sum(data[col] ** 2 for col in FEATURES_COL_NAMES)</span>
        <span class="n">data</span><span class="p">[</span><span class="s1">&#39;AveragedDensity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">FEATURES_COL_NAMES</span><span class="p">)</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.5</span>

        <span class="k">if</span> <span class="s1">&#39;DipoleFT_ww_reconstructed&#39;</span> <span class="ow">in</span> <span class="n">file_path</span><span class="p">:</span>
            <span class="c1"># FIXME Flip accross the frequency axis but keep the same index (idk why this bug exists)</span>
            <span class="n">data</span><span class="p">[</span><span class="s1">&#39;AveragedDensity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;AveragedDensity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                                                <span class="n">index</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;AveragedDensity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

        <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

        <span class="c1"># Preparing the data for plotting</span>
        <span class="n">omega_values</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;OmegaVec&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
        <span class="n">tauomega_values</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;TauOmegaVec&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>

        <span class="c1"># Creating a meshgrid for plotting</span>
        <span class="n">omega_grid</span><span class="p">,</span> <span class="n">tauomega_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">omega_values</span><span class="p">,</span> <span class="n">tauomega_values</span><span class="p">,</span> <span class="n">indexing</span><span class="o">=</span><span class="s1">&#39;ij&#39;</span><span class="p">)</span>

        <span class="c1"># Reshaping &#39;AveragedDensity&#39; to match the shape of the meshgrid</span>
        <span class="n">averaged_density_grid</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;AveragedDensity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">omega_grid</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

        <span class="c1">##############</span>
        <span class="kn">from</span> <span class="nn">scipy.signal</span> <span class="kn">import</span> <span class="n">find_peaks</span>
        <span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">MinMaxScaler</span>

        <span class="c1"># Adjusting peak analysis to be sensitive to both positive and negative values</span>
        <span class="c1"># Here, we&#39;ll find peaks on the absolute values of the max density along omega</span>
        <span class="n">peaks_positive</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">find_peaks</span><span class="p">(</span><span class="n">averaged_density_grid</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>  <span class="c1"># positive peaks</span>
        <span class="n">peaks_negative</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">find_peaks</span><span class="p">(</span><span class="o">-</span><span class="n">averaged_density_grid</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>  <span class="c1"># negative peaks</span>

        <span class="c1"># Dynamic range adjustment for the contour plots</span>
        <span class="c1"># Using percentiles to set color scale limits</span>
        <span class="n">percentile_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">averaged_density_grid</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">)</span>
        <span class="n">percentile_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">averaged_density_grid</span><span class="p">,</span> <span class="mf">99.9</span><span class="p">)</span>

        <span class="c1"># Symmetrical color map for first derivative</span>
        <span class="n">first_derivative</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span><span class="n">averaged_density_grid</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># recalculating first derivative</span>
        <span class="n">derivative_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">first_derivative</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">)</span>
        <span class="n">derivative_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">first_derivative</span><span class="p">,</span> <span class="mf">99.9</span><span class="p">)</span>
        <span class="n">derivative_abs_max</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">derivative_min</span><span class="p">),</span> <span class="nb">abs</span><span class="p">(</span><span class="n">derivative_max</span><span class="p">))</span>

        <span class="c1"># Plotting with adjustments</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>

        <span class="c1"># Adjusted Peak Analysis Plot</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">omega_values</span><span class="p">,</span> <span class="n">averaged_density_grid</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">omega_values</span><span class="p">[</span><span class="n">peaks_positive</span><span class="p">],</span> <span class="n">averaged_density_grid</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)[</span><span class="n">peaks_positive</span><span class="p">],</span> <span class="s2">&quot;x&quot;</span><span class="p">,</span>
                        <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">omega_values</span><span class="p">[</span><span class="n">peaks_negative</span><span class="p">],</span> <span class="n">averaged_density_grid</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)[</span><span class="n">peaks_negative</span><span class="p">],</span> <span class="s2">&quot;x&quot;</span><span class="p">,</span>
                        <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Peak Analysis&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;Blue: Positive Peaks, Red: Negative Peaks&quot;</span><span class="p">)</span>

        <span class="c1"># Integrated Density</span>
        <span class="n">scaler</span> <span class="o">=</span> <span class="n">MinMaxScaler</span><span class="p">()</span>
        <span class="n">normalized_density</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">averaged_density_grid</span><span class="p">)</span>
        <span class="n">integrated_density</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span><span class="n">normalized_density</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># integrating along tauomega</span>
        <span class="c1"># The plot for integrated density remains unchanged</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">omega_values</span><span class="p">,</span> <span class="n">integrated_density</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Integrated Density&quot;</span><span class="p">)</span>

        <span class="c1"># Adjusted First Derivative</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">omega_grid</span> <span class="o">+</span> <span class="n">tauomega_grid</span><span class="p">,</span> <span class="n">omega_grid</span><span class="p">,</span> <span class="n">first_derivative</span><span class="p">,</span>
                                         <span class="n">levels</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
                                         <span class="n">vmin</span><span class="o">=-</span><span class="n">derivative_abs_max</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">derivative_abs_max</span><span class="p">,</span>
                                         <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">),</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;First Derivative&quot;</span><span class="p">)</span>

        <span class="c1"># Adjusted Normalized Density</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">omega_grid</span> <span class="o">+</span> <span class="n">tauomega_grid</span><span class="p">,</span> <span class="n">omega_grid</span><span class="p">,</span> <span class="n">averaged_density_grid</span><span class="p">,</span>
                                         <span class="n">levels</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">,</span>
                                         <span class="n">norm</span><span class="o">=</span><span class="n">colors</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">percentile_min</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">percentile_max</span><span class="p">)</span>
                                         <span class="p">),</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Normalized Density (0.01</span><span class="si">% a</span><span class="s2">nd 99.9% Percentiles)&quot;</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="n">output_file</span> <span class="o">=</span> <span class="n">file_path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.csv&#39;</span><span class="p">,</span> <span class="s1">&#39;.png&#39;</span><span class="p">)</span>
        <span class="n">output_file</span> <span class="o">=</span> <span class="n">output_file</span> <span class="k">if</span> <span class="n">output_file</span> <span class="o">!=</span> <span class="n">file_path</span> <span class="k">else</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s1">.png&#39;</span>
        <span class="n">output_file</span> <span class="o">=</span> <span class="n">output_file</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.png&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;_Alternative_Plots.png&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">output_file</span><span class="p">)</span>
        <span class="c1"># plt.show()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">)</span></div>


<span class="sd">&#39;&#39;&#39;__helper_functions__&#39;&#39;&#39;</span>


<span class="k">def</span> <span class="nf">_plot_contour_map</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">x_label</span><span class="p">,</span> <span class="n">y_label</span><span class="p">,</span> <span class="n">output_file</span><span class="p">,</span> <span class="n">add_diagonal_line</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">contour_kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">contour_kwargs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">contour_kwargs</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="c1"># Creating an interactive plot using Plotly</span>
    <span class="kn">import</span> <span class="nn">plotly.graph_objects</span> <span class="k">as</span> <span class="nn">go</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">go</span><span class="o">.</span><span class="n">Contour</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="n">z</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span>
                                    <span class="o">**</span><span class="n">contour_kwargs</span><span class="p">))</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">xaxis_title</span><span class="o">=</span><span class="n">x_label</span><span class="p">,</span> <span class="n">yaxis_title</span><span class="o">=</span><span class="n">y_label</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">add_diagonal_line</span><span class="p">:</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">add_shape</span><span class="p">(</span>
            <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;line&quot;</span><span class="p">,</span>
            <span class="n">x0</span><span class="o">=</span><span class="nb">min</span><span class="p">(</span><span class="n">y</span><span class="p">),</span>
            <span class="n">y0</span><span class="o">=</span><span class="nb">min</span><span class="p">(</span><span class="n">y</span><span class="p">),</span>
            <span class="n">x1</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="n">y</span><span class="p">),</span>
            <span class="n">y1</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="n">y</span><span class="p">),</span>
            <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                <span class="n">color</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span>
                <span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                <span class="n">dash</span><span class="o">=</span><span class="s2">&quot;dot&quot;</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">write_html</span><span class="p">(</span><span class="n">output_file</span><span class="p">)</span>
    <span class="c1"># fig.show()</span>

    <span class="k">return</span> <span class="n">fig</span>


<span class="k">def</span> <span class="nf">_calculate_min_max_significant_time</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">target_column</span><span class="p">,</span> <span class="n">percentile_range</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">60</span><span class="p">)):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the min and max time for the significant data points using percentiles.</span>

<span class="sd">    Expected data format:</span>
<span class="sd">    Time, ..., target_column, Foo1, Foo2, Foo3, ...</span>

<span class="sd">    :param data: DataFrame containing the data.</span>
<span class="sd">    :param target_column: The name of the column with the target data.</span>
<span class="sd">    :param percentile_range: Tuple containing the lower and upper percentiles to consider.</span>
<span class="sd">    :return: Tuple with the min and max times corresponding to the significant data range.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">target_column</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;Column </span><span class="si">{</span><span class="n">target_column</span><span class="si">}</span><span class="s1"> not found in </span><span class="si">{</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="si">}</span><span class="s1">&#39;</span>

    <span class="c1"># Calculate the lower and upper bounds using percentiles</span>
    <span class="n">lower_bound</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">target_column</span><span class="p">]</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">percentile_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mi">100</span><span class="p">)</span>
    <span class="n">upper_bound</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">target_column</span><span class="p">]</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">percentile_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="mi">100</span><span class="p">)</span>

    <span class="c1"># Filter data within the percentile range</span>
    <span class="n">significant_data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[(</span><span class="n">data</span><span class="p">[</span><span class="n">target_column</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">lower_bound</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">target_column</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">upper_bound</span><span class="p">)]</span>

    <span class="c1"># Determine the range for the x-axis</span>
    <span class="n">min_time</span> <span class="o">=</span> <span class="n">significant_data</span><span class="p">[</span><span class="s1">&#39;Time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
    <span class="n">max_time</span> <span class="o">=</span> <span class="n">significant_data</span><span class="p">[</span><span class="s1">&#39;Time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">min_time</span><span class="p">,</span> <span class="n">max_time</span>


<span class="k">def</span> <span class="nf">__generate_atomic_charge_column_names</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">number_of_atoms</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">())</span>
        <span class="n">_</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>  <span class="c1"># Skipping the molecule name line</span>
        <span class="n">atom_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number_of_atoms</span><span class="p">)]</span>

    <span class="c1"># Initialize counters for each atom name</span>
    <span class="n">atom_name_counts</span> <span class="o">=</span> <span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">atom_names</span><span class="p">)}</span>

    <span class="c1"># Initialize the list of column names</span>
    <span class="n">column_names</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Generate column names with suffixes for repeated atom names</span>
    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">atom_names</span><span class="p">:</span>
        <span class="n">count</span> <span class="o">=</span> <span class="n">atom_name_counts</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="n">suffix</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;.</span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">count</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
        <span class="k">for</span> <span class="n">axis</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="s1">&#39;Z&#39;</span><span class="p">]:</span>
            <span class="n">column_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Atom_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">_Charge</span><span class="si">{</span><span class="n">axis</span><span class="si">}{</span><span class="n">suffix</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">atom_name_counts</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">return</span> <span class="n">column_names</span>


<span class="k">def</span> <span class="nf">__generate_atomic_FTcharge_column_names</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
    <span class="n">xyz_file_content</span> <span class="o">=</span> <span class="n">read_xyz</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
    <span class="n">atoms</span> <span class="o">=</span> <span class="n">xyz_file_content</span><span class="p">[</span><span class="s1">&#39;atoms&#39;</span><span class="p">]</span>

    <span class="c1"># Initialize counters for each atom name</span>
    <span class="n">atom_name_counts</span> <span class="o">=</span> <span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">([</span><span class="n">atom_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">atom_name</span> <span class="ow">in</span> <span class="n">atoms</span><span class="o">.</span><span class="n">keys</span><span class="p">()])}</span>

    <span class="c1"># Initialize the list of column names</span>
    <span class="n">column_names</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Generate column names with suffixes for repeated atom names</span>
    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">atoms</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">_name</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">count</span> <span class="o">=</span> <span class="n">atom_name_counts</span><span class="p">[</span><span class="n">_name</span><span class="p">]</span>
        <span class="n">suffix</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;.</span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">count</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
        <span class="k">for</span> <span class="n">axis</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="s1">&#39;Z&#39;</span><span class="p">]:</span>
            <span class="k">for</span> <span class="n">component</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;Re&#39;</span><span class="p">,</span> <span class="s1">&#39;Im&#39;</span><span class="p">]:</span>
                <span class="n">column_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Atom_</span><span class="si">{</span><span class="n">_name</span><span class="si">}</span><span class="s1">_FTCharge</span><span class="si">{</span><span class="n">axis</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">component</span><span class="si">}{</span><span class="n">suffix</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">atom_name_counts</span><span class="p">[</span><span class="n">_name</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">return</span> <span class="n">column_names</span>


<span class="k">def</span> <span class="nf">__generate_becke_atomic_weghts_column_names</span><span class="p">(</span><span class="n">xyz_geometry_path</span><span class="p">):</span>
    <span class="n">xyz_file_content</span> <span class="o">=</span> <span class="n">read_xyz</span><span class="p">(</span><span class="n">xyz_geometry_path</span><span class="p">)</span>
    <span class="n">atoms</span> <span class="o">=</span> <span class="n">xyz_file_content</span><span class="p">[</span><span class="s1">&#39;atoms&#39;</span><span class="p">]</span>

    <span class="c1"># Initialize counters for each atom name</span>
    <span class="n">atom_name_counts</span> <span class="o">=</span> <span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">([</span><span class="n">atom_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">atom_name</span> <span class="ow">in</span> <span class="n">atoms</span><span class="o">.</span><span class="n">keys</span><span class="p">()])}</span>

    <span class="c1"># Initialize the list of column names</span>
    <span class="n">column_names</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Generate column names with suffixes for repeated atom names</span>
    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">atoms</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">_name</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">count</span> <span class="o">=</span> <span class="n">atom_name_counts</span><span class="p">[</span><span class="n">_name</span><span class="p">]</span>
        <span class="n">suffix</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;.</span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">count</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
        <span class="n">column_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Atom_</span><span class="si">{</span><span class="n">_name</span><span class="si">}</span><span class="s1">_ChargeDensity</span><span class="si">{</span><span class="n">suffix</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">atom_name_counts</span><span class="p">[</span><span class="n">_name</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">return</span> <span class="n">column_names</span>


<span class="sd">&#39;&#39;&#39;Becke Plots&#39;&#39;&#39;</span>


<div class="viewcode-block" id="plot_becke_weights"><a class="viewcode-back" href="../../../post_processing.plotting_module.html#post_processing.plotting_module.plot_becke_weights">[docs]</a><span class="k">def</span> <span class="nf">plot_becke_weights</span><span class="p">(</span><span class="n">study_directory</span><span class="p">,</span> <span class="n">experiment_directory</span><span class="p">,</span> <span class="n">xyz_geometry_path</span><span class="p">,</span> <span class="n">weights_file</span><span class="p">):</span>
    <span class="c1"># &quot;x&quot;,&quot;y&quot;,&quot;z&quot;,&quot;Atom_O_ChargeDensity&quot;,&quot;Atom_N_ChargeDensity&quot;,&quot;Atom_C_ChargeDensity&quot;,&quot;Atom_C_ChargeDensity&quot;,</span>
    <span class="c1"># &quot;Atom_C_ChargeDensity&quot;,&quot;Atom_H_ChargeDensity&quot;,&quot;Atom_H_ChargeDensity&quot;,&quot;Atom_H_ChargeDensity&quot;,</span>
    <span class="c1"># &quot;Atom_H_ChargeDensity&quot;,&quot;Atom_H_ChargeDensity&quot;,&quot;Atom_H_ChargeDensity&quot;,&quot;Atom_H_ChargeDensity&quot;</span>
    <span class="k">if</span> <span class="n">weights_file</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># Use the expected default from the ChargeMigration/Becke code</span>
        <span class="n">weights_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">study_directory</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">experiment_directory</span><span class="si">}</span><span class="s1">/Weights_File_</span><span class="si">{</span><span class="n">experiment_directory</span><span class="si">}</span><span class="s1">.csv&#39;</span>

    <span class="c1"># Read the XYZ file to get the number of atoms, the name of the atom and the atom names</span>
    <span class="c1"># (this is the order in which the atoms are listed in the CSV file)</span>
    <span class="n">xyz_file_content</span> <span class="o">=</span> <span class="n">read_xyz</span><span class="p">(</span><span class="n">xyz_geometry_path</span><span class="p">)</span>
    <span class="n">number_of_atoms</span> <span class="o">=</span> <span class="n">xyz_file_content</span><span class="p">[</span><span class="s1">&#39;n_atoms&#39;</span><span class="p">]</span>
    <span class="n">name_of_molecule</span> <span class="o">=</span> <span class="n">xyz_file_content</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span>
    <span class="n">atoms</span> <span class="o">=</span> <span class="n">xyz_file_content</span><span class="p">[</span><span class="s1">&#39;atoms&#39;</span><span class="p">]</span>
    <span class="n">ATOMIC_FT_COL_NAMES</span> <span class="o">=</span> <span class="n">__generate_becke_atomic_weghts_column_names</span><span class="p">(</span><span class="n">xyz_geometry_path</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">number_of_atoms</span><span class="w"> </span><span class="si">= }</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">ATOMIC_FT_COL_NAMES</span><span class="w"> </span><span class="si">= }</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">number_of_atoms</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span>
        <span class="n">ATOMIC_FT_COL_NAMES</span><span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">number_of_atoms</span><span class="w"> </span><span class="si">= }</span><span class="s1"> != </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">ATOMIC_FT_COL_NAMES</span><span class="p">)</span><span class="w"> </span><span class="si">= }</span><span class="s1"> check read_xyz and __generate_becke_atomic_weghts_column_names&#39;</span>

    <span class="c1"># Load the CSV file</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Plotting </span><span class="si">{</span><span class="n">weights_file</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">weights_file</span><span class="p">)</span>

    <span class="c1"># Displaying the first few rows of the file to understand its structure</span>
    <span class="c1"># all columns</span>
    <span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.max_columns&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Length of Weight data: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="si">}</span><span class="s1"> points&#39;</span><span class="p">)</span>

    <span class="c1"># Create a 3d plot of the weights with each atom/column as a different color scaled by the density/value of the point</span>
    <span class="c1"># Plotting</span>
    <span class="kn">import</span> <span class="nn">plotly.graph_objects</span> <span class="k">as</span> <span class="nn">go</span>

    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">3</span><span class="p">:]:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s1"> = </span><span class="si">{</span><span class="n">data</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s1"> has a min value of </span><span class="si">{</span><span class="n">data</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="si">}</span><span class="s1"> rather than 0&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s1"> has a max value of </span><span class="si">{</span><span class="n">data</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">}</span><span class="s1"> rather than 1&#39;</span><span class="p">)</span>

    <span class="c1"># Plot only one atom type for debugging</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">go</span><span class="o">.</span><span class="n">Scatter3d</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">],</span>
        <span class="n">y</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">],</span>
        <span class="n">z</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">],</span>
        <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;markers&#39;</span><span class="p">,</span>
        <span class="n">marker</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
            <span class="n">size</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Atom_H_ChargeDensity.4&#39;</span><span class="p">],</span>  <span class="c1"># Replace with the correct column name</span>
            <span class="n">colorscale</span><span class="o">=</span><span class="s1">&#39;Viridis&#39;</span><span class="p">,</span>
            <span class="n">opacity</span><span class="o">=</span><span class="mf">0.5</span>
        <span class="p">)</span>
    <span class="p">))</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;3D Scatter Plot for Atom_H_ChargeDensity.4&#39;</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="n">exit</span><span class="p">()</span>

    <span class="c1"># Given the content of the file, let&#39;s create a DataFrame manually and plot it</span>

    <span class="kn">import</span> <span class="nn">plotly.graph_objects</span> <span class="k">as</span> <span class="nn">go</span>

    <span class="n">R_el_bc</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">study_directory</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">experiment_directory</span><span class="si">}</span><span class="s1">/R_el_bc.csv&#39;</span><span class="p">)</span>
    <span class="c1"># Create the figure</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>

    <span class="c1"># Add a trace for each unique atom type</span>
    <span class="k">for</span> <span class="n">atom_name</span> <span class="ow">in</span> <span class="n">R_el_bc</span><span class="p">[</span><span class="s1">&#39;Atom_Name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
        <span class="n">atom_data</span> <span class="o">=</span> <span class="n">R_el_bc</span><span class="p">[</span><span class="n">R_el_bc</span><span class="p">[</span><span class="s1">&#39;Atom_Name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">atom_name</span><span class="p">]</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span>
            <span class="n">go</span><span class="o">.</span><span class="n">Scatter3d</span><span class="p">(</span>
                <span class="n">x</span><span class="o">=</span><span class="n">atom_data</span><span class="p">[</span><span class="s1">&#39;X_Position&#39;</span><span class="p">],</span>
                <span class="n">y</span><span class="o">=</span><span class="n">atom_data</span><span class="p">[</span><span class="s1">&#39;Y_Position&#39;</span><span class="p">],</span>
                <span class="n">z</span><span class="o">=</span><span class="n">atom_data</span><span class="p">[</span><span class="s1">&#39;Z_Position&#39;</span><span class="p">],</span>
                <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;markers&#39;</span><span class="p">,</span>
                <span class="n">marker</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">0.8</span><span class="p">),</span>
                <span class="n">name</span><span class="o">=</span><span class="n">atom_name</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>

    <span class="c1"># Update the layout</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
        <span class="n">title</span><span class="o">=</span><span class="s1">&#39;3D Scatter Plot of Atoms&#39;</span><span class="p">,</span>
        <span class="n">scene</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
            <span class="n">xaxis_title</span><span class="o">=</span><span class="s1">&#39;X Position&#39;</span><span class="p">,</span>
            <span class="n">yaxis_title</span><span class="o">=</span><span class="s1">&#39;Y Position&#39;</span><span class="p">,</span>
            <span class="n">zaxis_title</span><span class="o">=</span><span class="s1">&#39;Z Position&#39;</span>
        <span class="p">),</span>
        <span class="n">margin</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">l</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="c1"># Display the plot</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>


<span class="sd">&#39;&#39;&#39;Correlation Graphs&#39;&#39;&#39;</span>


<div class="viewcode-block" id="plot_dipole_correlation_maps"><a class="viewcode-back" href="../../../post_processing.plotting_module.html#post_processing.plotting_module.plot_dipole_correlation_maps">[docs]</a><span class="k">def</span> <span class="nf">plot_dipole_correlation_maps</span><span class="p">(</span><span class="n">study_directory</span><span class="p">,</span> <span class="n">experiment_directory</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
    <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="w">    </span><span class="sd">&#39;&#39;&#39;FT WW&#39;&#39;&#39;</span>
    <span class="n">atomic_ft_ww</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">study_directory</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">experiment_directory</span><span class="si">}</span><span class="s1">/AtomicCharge/AtomicChargeFT_ww.csv&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>
    <span class="n">atomic_ft_ww_real</span> <span class="o">=</span> <span class="n">atomic_ft_ww</span><span class="p">[[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">atomic_ft_ww</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="s1">&#39;_Re&#39;</span> <span class="ow">in</span> <span class="n">col</span><span class="p">]]</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">atomic_ft_ww_real</span><span class="o">.</span><span class="n">corr</span><span class="p">(),</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">square</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">linewidths</span><span class="o">=</span><span class="mf">.5</span><span class="p">,</span> <span class="n">cbar_kws</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;shrink&quot;</span><span class="p">:</span> <span class="mf">.5</span><span class="p">},</span> <span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Atomic Charge FT ww Correlation Matrix&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">study_directory</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">experiment_directory</span><span class="si">}</span><span class="s1">/AtomicChargeFT_ww_CorrelationMatrix_Real.png&#39;</span><span class="p">)</span>

<span class="w">    </span><span class="sd">&#39;&#39;&#39;FT ALL&#39;&#39;&#39;</span>
    <span class="n">atomic_ft_all</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">study_directory</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">experiment_directory</span><span class="si">}</span><span class="s1">/AtomicCharge/AtomicChargeFT_ALL.csv&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>
    <span class="n">atomic_ft_all_real</span> <span class="o">=</span> <span class="n">atomic_ft_all</span><span class="p">[[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">atomic_ft_all</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="s1">&#39;_Re&#39;</span> <span class="ow">in</span> <span class="n">col</span><span class="p">]]</span>

    <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">atomic_ft_all_real</span><span class="o">.</span><span class="n">corr</span><span class="p">(),</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>  <span class="n">square</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">linewidths</span><span class="o">=</span><span class="mf">.5</span><span class="p">,</span> <span class="n">cbar_kws</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;shrink&quot;</span><span class="p">:</span> <span class="mf">.5</span><span class="p">},</span>  <span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Atomic Charge FT ALL Correlation Matrix&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">study_directory</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">experiment_directory</span><span class="si">}</span><span class="s1">/AtomicChargeFT_ALL_CorrelationMatrix_Real.png&#39;</span><span class="p">)</span>

<span class="w">    </span><span class="sd">&#39;&#39;&#39;Dipole FT WW and Dipole FT WW Reconstructed&#39;&#39;&#39;</span>
    <span class="n">OMEGA_TAUOMEGA_FILE_NAMES</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;Dipole/DipoleFT_ww.csv&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Dipole/DipoleFT_ww_reconstructed.csv&#39;</span><span class="p">,</span>
    <span class="p">]</span>
    <span class="n">OMEGA_TAUOMEGA_FILE_PATHS</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">study_directory</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">experiment_directory</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">file_name</span> <span class="ow">in</span>
                                 <span class="n">OMEGA_TAUOMEGA_FILE_NAMES</span><span class="p">]</span>

    <span class="n">length_of_data_to_match</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">FEATURES_COL_NAMES</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;2DDipoleX_Re&#39;</span><span class="p">,</span>
        <span class="s1">&#39;2DDipoleX_Im&#39;</span><span class="p">,</span>
        <span class="s1">&#39;2DDipoleY_Re&#39;</span><span class="p">,</span>
        <span class="s1">&#39;2DDipoleY_Im&#39;</span><span class="p">,</span>
        <span class="s1">&#39;2DDipoleZ_Re&#39;</span><span class="p">,</span>
        <span class="s1">&#39;2DDipoleZ_Im&#39;</span>
    <span class="p">]</span>
    <span class="n">datas</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># Make sure to vary the names by adding _reconstructed</span>
    <span class="n">suffix_names</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">file_path</span> <span class="ow">in</span> <span class="n">OMEGA_TAUOMEGA_FILE_PATHS</span><span class="p">:</span>
        <span class="n">suffix_name</span> <span class="o">=</span> <span class="n">file_path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.csv&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">suffix_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">suffix_name</span><span class="p">)</span>

        <span class="c1"># Load the CSV file</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Plotting </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">length_of_data_to_match</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">length_of_data_to_match</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">length_of_data_to_match</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span>
                <span class="n">data</span><span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;Length of </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s1"> is not the same as the previous file&#39;</span>

        <span class="c1"># Displaying the first few rows of the file to understand its structure</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Length of data: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="c1"># Calculating the average of all polarizations</span>
        <span class="c1"># data[&#39;AveragedDensity&#39;] = sum(data[col] ** 2 for col in FEATURES_COL_NAMES)</span>
        <span class="n">data</span><span class="p">[</span><span class="s1">&#39;AveragedDensity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">FEATURES_COL_NAMES</span><span class="p">)</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.5</span>

        <span class="k">if</span> <span class="s1">&#39;DipoleFT_ww_reconstructed&#39;</span> <span class="ow">in</span> <span class="n">file_path</span><span class="p">:</span>
            <span class="c1"># FIXME Flip accross the frequency axis but keep the same index (idk why this bug exists)</span>
            <span class="n">data</span><span class="p">[</span><span class="s1">&#39;AveragedDensity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;AveragedDensity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                                                <span class="n">index</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;AveragedDensity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

        <span class="n">datas</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span>
        <span class="c1"># Two figures</span>
        <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">datas</span><span class="p">):</span>
        <span class="c1"># Drop the omega columns</span>
        <span class="n">plot_data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;OmegaVec&#39;</span><span class="p">,</span> <span class="s1">&#39;TauOmegaVec&#39;</span><span class="p">,</span> <span class="s1">&#39;AveragedDensity&#39;</span><span class="p">])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Correlation Matrix &#39;</span> <span class="o">+</span> <span class="n">suffix_names</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">plot_data</span><span class="o">.</span><span class="n">corr</span><span class="p">(),</span>
                    <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                    <span class="n">square</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span><span class="mf">.5</span><span class="p">,</span> <span class="n">cbar_kws</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;shrink&quot;</span><span class="p">:</span> <span class="mf">.5</span><span class="p">},</span>
                    <span class="c1"># limit how many decimal places are shown</span>
                    <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;.1f&#39;</span>

                    <span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">study_directory</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">experiment_directory</span><span class="si">}</span><span class="s1">/2DDipoleCorrelationMatrix.png&#39;</span><span class="p">)</span></div>



<div class="viewcode-block" id="plot_cm_correlation_maps"><a class="viewcode-back" href="../../../post_processing.plotting_module.html#post_processing.plotting_module.plot_cm_correlation_maps">[docs]</a><span class="k">def</span> <span class="nf">plot_cm_correlation_maps</span><span class="p">(</span><span class="n">study_directory</span><span class="p">,</span> <span class="n">experiment_directory</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
    <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="w">    </span><span class="sd">&#39;&#39;&#39;FT WW&#39;&#39;&#39;</span>
    <span class="n">atomic_cm</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">study_directory</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">experiment_directory</span><span class="si">}</span><span class="s1">/ChargeDensity/ChDenSimPP-200/ChDen54.3465.csv&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>
    <span class="c1"># Remove the axis columns</span>
    <span class="n">plot_atomic_cm</span> <span class="o">=</span> <span class="n">atomic_cm</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">])</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">plot_atomic_cm</span><span class="o">.</span><span class="n">corr</span><span class="p">(),</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="c1"># We are plotting the correlation matrix thus i need a diverging color map but better than viridis</span>
                <span class="c1"># cmap=&#39;viridis&#39;,</span>
                <span class="c1"># cmap=&#39;seismic&#39;,</span>
                <span class="c1"># cmap=&#39;coolwarm&#39;,</span>
                <span class="c1"># cmap=&#39;twilight_shifted&#39;,</span>
                <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;vlag&#39;</span><span class="p">,</span>
                 <span class="n">vmin</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">square</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">linewidths</span><span class="o">=</span><span class="mf">.5</span><span class="p">,</span> <span class="n">cbar_kws</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;shrink&quot;</span><span class="p">:</span> <span class="mf">.5</span><span class="p">},</span>
                <span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Charge Density Correlation Matrix&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">study_directory</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">experiment_directory</span><span class="si">}</span><span class="s1">/ChargeDensity_CorrelationMatrix.png&#39;</span><span class="p">)</span></div>
    <span class="c1"># plt.show()</span>

    <span class="c1"># exit()</span>
    <span class="c1"># sns.pairplot(plot_atomic_cm)</span>
    <span class="c1"># plt.savefig(f&#39;{study_directory}/{experiment_directory}/ChargeDensity_PairPlot.png&#39;)</span>

    <span class="c1"># sns.jointplot(data=plot_atomic_cm)</span>
    <span class="c1"># plt.savefig(f&#39;{study_directory}/{experiment_directory}/ChargeDensity_JointPlot.png&#39;)</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Ruben Fernandez Carbon.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>