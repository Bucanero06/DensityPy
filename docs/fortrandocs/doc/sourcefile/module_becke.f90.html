<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta name="description" content="Documentation for Charge Migration">
    <meta name="author" content="" >
    <link rel="icon" href="../favicon.png">

    <title>Module_Becke.f90 &ndash; Charge Migration</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <link href="../css/pygments.css" rel="stylesheet">
    <link href="../css/font-awesome.min.css" rel="stylesheet">
    <link href="../css/local.css" rel="stylesheet">
      <link  href="../tipuesearch/tipuesearch.css" rel="stylesheet">

    <script src="https://code.jquery.com/jquery-3.7.0.slim.min.js" integrity="sha256-tG5mcZUtJsZvyKAxYLVXrmjKBVLd6VpVccqz/r4ypFE=" crossorigin="anonymous"></script>
  </head>

  <body>

    <!-- Fixed navbar -->
    <div class="container-fluid mb-sm-4 mb-xl-2">
      <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
        <div class="container">
          <a class="navbar-brand" href="../index.html">Charge Migration </a>
          <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar"
                  aria-expanded="false" aria-controls="navbar" aria-label="Toggle navigation">
                  <span class="navbar-toggler-icon">
          </button>

          <div id="navbar" class="navbar-collapse collapse">
            <ul class="navbar-nav">
                  <li class="nav-item">
                    <a class="nav-link" href="../lists/files.html">Source Files</a>
                  </li>
                <li class="nav-item">
                  <a class="nav-link" href="../lists/modules.html">Modules</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="../lists/procedures.html">Procedures</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="../lists/programs.html">Programs</a>
                </li>
            </ul>
              <div class="d-flex align-items-end flex-grow-1">
                <form action="../search.html" role="search" class="ms-auto">
                  <input type="text" class="form-control" aria-label="Search" placeholder="Search" name="q" id="tipue_search_input" autocomplete="off" required>
                </form>
              </div>
          </div><!--/.nav-collapse -->
        </div>
      </nav>
    </div>

    <div class="container">
  <div class="row">
    <h1>Module_Becke.f90
      <small>Source File</small>
      
    </h1>
      <div class="container p-2 mb-4 bg-light border rounded-3">
    <div class="row align-items-center justify-content-between" id="info-bar">
      <div class="col">
        <ul class="list-inline" style="margin-bottom:0px;display:inline">

            <li class="list-inline-item" id="statements"><i class="fa fa-list-ol"></i>
              <a data-bs-toggle="tooltip"
                 data-bs-placement="bottom" data-html="true"
                 title=" 4.5% of total for source files.">102 statements</a>
            </li>

            <li class="list-inline-item" id="source-file">
              <i class="fa fa-code"></i>
              <a href="../src/Module_Becke.f90"> Source File</a>
            </li>
        </ul>
      </div>
      <div class="col">
        <nav aria-label="breadcrumb">
          <ol class="breadcrumb justify-content-end mb-0">
            <li class="breadcrumb-item active" aria-current="page">Module_Becke.f90</li>
          </ol>
        </nav>
      </div>
    </div>
  </div>
  <script>
    $(function () {
    $('[data-bs-toggle="tooltip"]').tooltip()
    })
  </script>

  </div>
  <div class="row">
    <div class="col-md-3 hidden-xs hidden-sm visible-md visible-lg">
        <div id="sidebar">
      <h3>Contents</h3>
  
  
  
  
  
      <div class="card mb-4">
      <a data-bs-toggle="collapse" href="#mods-0"
         aria-expanded="false" aria-controls="mods-0">
         <h4 class="card-header bg-primary text-white">Modules</h4>
      </a>
      <div id="mods-0" class="collapse">
        <div class="list-group list-group-flush">
            <a class="list-group-item" href="../module/module_becke.html">Module_Becke</a>
        </div>
      </div>
    </div>

  
  
  
  
  
  
  
  
  
  
  
  
  
  
    <div class="card card-primary">
      <div class="card-header text-left"><h3 class="card-title">Source Code</h3></div>
      <div class="list-group">
        <a class="list-group-item" href="../sourcefile/module_becke.f90.html#src">Module_Becke.f90</a>
      </div>
    </div>


  </div>

    </div>
    <div class="col-md-9" id='text'>
      
      <br>
        <div class="card">
          <div class="card-header">
            <h3 class="card-title">Files dependent on this one</h3>
          </div>
          <div class="card-body">
            <div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: sourcefile~~module_becke.f90~~AfferentGraph Pages: 1 -->
<svg id="sourcefilemodule_beckef90AfferentGraph" width="214pt" height="32pt"
 viewBox="0.00 0.00 214.00 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="sourcefile~~module_becke.f90~~AfferentGraph" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>sourcefile~~module_becke.f90~~AfferentGraph</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-28 210,-28 210,4 -4,4"/>
<!-- sourcefile~module_becke.f90 -->
<g id="sourcefile~~module_becke.f90~~AfferentGraph_node1" class="node">
<title>sourcefile~module_becke.f90</title>
<polygon fill="none" stroke="black" points="110,-24 0,-24 0,0 110,0 110,-24"/>
<text text-anchor="middle" x="55" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50">Module_Becke.f90</text>
</g>
<!-- sourcefile~main.f90~2 -->
<g id="sourcefile~~module_becke.f90~~AfferentGraph_node2" class="node">
<title>sourcefile~main.f90~2</title>
<g id="a_sourcefile~~module_becke.f90~~AfferentGraph_node2"><a xlink:href=".././sourcefile/main.f90~2.html" xlink:title="main.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="206,-24 146,-24 146,0 206,0 206,-24"/>
<text text-anchor="middle" x="176" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">main.f90</text>
</a>
</g>
</g>
<!-- sourcefile~main.f90~2&#45;&gt;sourcefile~module_becke.f90 -->
<g id="sourcefile~~module_becke.f90~~AfferentGraph_edge1" class="edge">
<title>sourcefile~main.f90~2&#45;&gt;sourcefile~module_becke.f90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M145.89,-12C138.09,-12 129.34,-12 120.44,-12"/>
<polygon fill="#000000" stroke="#000000" points="120.37,-8.5 110.37,-12 120.37,-15.5 120.37,-8.5"/>
</g>
</g>
</svg>
</div>        <div><a type="button" class="graph-help" data-toggle="modal" href="#AfferentGraph-help-text">Help</a></div>
          <div class="modal fade" id="AfferentGraph-help-text" tabindex="-1" role="dialog">
            <div class="modal-dialog modal-lg" role="document">
              <div class="modal-content">
                <div class="modal-header">
                  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                  </button>
                  <h4 class="modal-title" id="-graph-help-label">Graph Key</h4>
                </div>
              <div class="modal-body">
<p>Nodes of different colours represent the following: </p>
<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="202pt" height="32pt"
 viewBox="0.00 0.00 201.50 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-28 197.5,-28 197.5,4 -4,4"/>
<!-- Source File -->
<g id="node1" class="node">
<title>Source File</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="70,-24 0,-24 0,0 70,0 70,-24"/>
<text text-anchor="middle" x="35" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Source File</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node2" class="node">
<title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="black" points="193.5,-24 88.5,-24 88.5,0 193.5,0 193.5,-24"/>
<text text-anchor="middle" x="141" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50">This Page&#39;s Entity</text>
</g>
</g>
</svg>

<p>Solid arrows point from a file to a file which it depends on. A file
is dependent upon another if the latter must be compiled before the former
can be.
</p>
 </div>
            </div>
          </div>
        </div>
          </div>
        </div>
<br>
      <section>
        <h2><span class="anchor" id="src"></span>Source Code</h2>
        <div class="hl codehilite"><pre><span></span><a id="ln-1" name="ln-1" href="#ln-1"></a><span class="k">Module </span><span class="n">Module_Becke</span>
<a id="ln-2" name="ln-2" href="#ln-2"></a>
<a id="ln-3" name="ln-3" href="#ln-3"></a><span class="w">    </span><span class="k">use</span><span class="p">,</span><span class="w"> </span><span class="k">intrinsic</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">ISO_FORTRAN_ENV</span>
<a id="ln-4" name="ln-4" href="#ln-4"></a>
<a id="ln-5" name="ln-5" href="#ln-5"></a><span class="w">    </span><span class="k">implicit none</span>
<a id="ln-6" name="ln-6" href="#ln-6"></a>
<a id="ln-7" name="ln-7" href="#ln-7"></a><span class="k">    private</span>
<a id="ln-8" name="ln-8" href="#ln-8"></a>
<a id="ln-9" name="ln-9" href="#ln-9"></a><span class="k">    </span><span class="kt">logical</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">Verbous</span>
<a id="ln-10" name="ln-10" href="#ln-10"></a>
<a id="ln-11" name="ln-11" href="#ln-11"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="p">&amp;</span>
<a id="ln-12" name="ln-12" href="#ln-12"></a><span class="w">            </span><span class="n">EuclDist</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span>
<a id="ln-13" name="ln-13" href="#ln-13"></a><span class="w">            </span><span class="n">EllipticalCoord</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span>
<a id="ln-14" name="ln-14" href="#ln-14"></a><span class="w">            </span><span class="n">Radius_Table</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span>
<a id="ln-15" name="ln-15" href="#ln-15"></a><span class="w">            </span><span class="n">get_param_a</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span>
<a id="ln-16" name="ln-16" href="#ln-16"></a><span class="w">            </span><span class="n">new_mu_transformation</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span>
<a id="ln-17" name="ln-17" href="#ln-17"></a><span class="w">            </span><span class="n">fkfun</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span>
<a id="ln-18" name="ln-18" href="#ln-18"></a><span class="w">            </span><span class="n">skfun</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span>
<a id="ln-19" name="ln-19" href="#ln-19"></a><span class="w">            </span><span class="n">skfunab</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span>
<a id="ln-20" name="ln-20" href="#ln-20"></a><span class="w">            </span><span class="n">Pkfuna</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span>
<a id="ln-21" name="ln-21" href="#ln-21"></a><span class="w">            </span><span class="n">PkFunTot</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span>
<a id="ln-22" name="ln-22" href="#ln-22"></a><span class="w">            </span><span class="n">wkfun</span>
<a id="ln-23" name="ln-23" href="#ln-23"></a>
<a id="ln-24" name="ln-24" href="#ln-24"></a><span class="k">contains</span>
<a id="ln-25" name="ln-25" href="#ln-25"></a><span class="w">    </span><span class="c">! &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span>
<a id="ln-26" name="ln-26" href="#ln-26"></a><span class="w">    </span><span class="c">!! This code is a Fortran implementation of the Becke partitioning scheme based on the following papers:</span>
<a id="ln-27" name="ln-27" href="#ln-27"></a><span class="w">    </span><span class="c">!!</span>
<a id="ln-28" name="ln-28" href="#ln-28"></a><span class="w">    </span><span class="c">!! H. Gharibnejad, N. Douguet, B.I. Schneider, J. Olsen, L. Argenti,</span>
<a id="ln-29" name="ln-29" href="#ln-29"></a><span class="w">    </span><span class="c">!!  A multi-center quadrature scheme for the molecular continuum,</span>
<a id="ln-30" name="ln-30" href="#ln-30"></a><span class="w">    </span><span class="c">!!  Computer Physics Communications, Volume 263, 2021, 107889, ISSN 0010-4655,</span>
<a id="ln-31" name="ln-31" href="#ln-31"></a><span class="w">    </span><span class="c">!!  https://doi.org/10.1016/j.cpc.2021.107889.</span>
<a id="ln-32" name="ln-32" href="#ln-32"></a><span class="w">    </span><span class="c">!!</span>
<a id="ln-33" name="ln-33" href="#ln-33"></a><span class="w">    </span><span class="c">!! and</span>
<a id="ln-34" name="ln-34" href="#ln-34"></a><span class="w">    </span><span class="c">!!</span>
<a id="ln-35" name="ln-35" href="#ln-35"></a><span class="w">    </span><span class="c">!! A. D. Becke; A multicenter numerical integration scheme for polyatomic molecules.</span>
<a id="ln-36" name="ln-36" href="#ln-36"></a><span class="w">    </span><span class="c">!!  J. Chem. Phys. 15 February 1988; 88 (4): 2547–2553. https://doi.org/10.1063/1.454033</span>
<a id="ln-37" name="ln-37" href="#ln-37"></a><span class="w">    </span><span class="c">!!</span>
<a id="ln-38" name="ln-38" href="#ln-38"></a><span class="w">    </span><span class="c">!! ----------------------------------------------------</span>
<a id="ln-39" name="ln-39" href="#ln-39"></a><span class="w">    </span><span class="c">!!\(Result = P_a(\vec{r})/\sum_bP_b(\vec{r}) \)</span>
<a id="ln-40" name="ln-40" href="#ln-40"></a><span class="w">    </span><span class="c">!! ----------------------------------------------------</span>
<a id="ln-41" name="ln-41" href="#ln-41"></a><span class="w">    </span><span class="c">!!</span>
<a id="ln-42" name="ln-42" href="#ln-42"></a><span class="w">    </span><span class="c">!! Quick Notes:</span>
<a id="ln-43" name="ln-43" href="#ln-43"></a><span class="w">    </span><span class="c">!!</span>
<a id="ln-44" name="ln-44" href="#ln-44"></a><span class="w">    </span><span class="c">!!Radius_Table: Given the name of an atom, returns its atomic radius. Only supports H, C, N, O, and Mg.</span>
<a id="ln-45" name="ln-45" href="#ln-45"></a><span class="w">    </span><span class="c">!!</span>
<a id="ln-46" name="ln-46" href="#ln-46"></a><span class="w">    </span><span class="c">!!get_param_a: Given two radii R_i and R_j, returns a transformed parameter a_ij. If the absolute value of \(a_{ij}\) is greater than 0.5, it&#39;s set to 0.5.</span>
<a id="ln-47" name="ln-47" href="#ln-47"></a><span class="w">    </span><span class="c">!!</span>
<a id="ln-48" name="ln-48" href="#ln-48"></a><span class="w">    </span><span class="c">!!new_mu_transformation: Returns a new mu parameter, given the original mu and \(a_{ij}\).</span>
<a id="ln-49" name="ln-49" href="#ln-49"></a><span class="w">    </span><span class="c">!!</span>
<a id="ln-50" name="ln-50" href="#ln-50"></a><span class="w">    </span><span class="c">!!wkfun: Calculates a weighted function for atom i.</span>
<a id="ln-51" name="ln-51" href="#ln-51"></a><span class="w">    </span><span class="c">!!</span>
<a id="ln-52" name="ln-52" href="#ln-52"></a><span class="w">    </span><span class="c">!!PkFunTot: Sums up the function Pkfuna over all atoms.</span>
<a id="ln-53" name="ln-53" href="#ln-53"></a><span class="w">    </span><span class="c">!!</span>
<a id="ln-54" name="ln-54" href="#ln-54"></a><span class="w">    </span><span class="c">!!Pkfuna: Calculates a product of skfunab over all atoms excluding atom i.</span>
<a id="ln-55" name="ln-55" href="#ln-55"></a><span class="w">    </span><span class="c">!!</span>
<a id="ln-56" name="ln-56" href="#ln-56"></a><span class="w">    </span><span class="c">!!skfunab: Transforms an elliptical coordinate to a new mu, then returns the result of skfun with this new mu.</span>
<a id="ln-57" name="ln-57" href="#ln-57"></a><span class="w">    </span><span class="c">!!</span>
<a id="ln-58" name="ln-58" href="#ln-58"></a><span class="w">    </span><span class="c">!!skfun: Transforms a mu parameter into a step function.</span>
<a id="ln-59" name="ln-59" href="#ln-59"></a><span class="w">    </span><span class="c">!!</span>
<a id="ln-60" name="ln-60" href="#ln-60"></a><span class="w">    </span><span class="c">!!fkfun: Recursively calculates a function of mu.</span>
<a id="ln-61" name="ln-61" href="#ln-61"></a><span class="w">    </span><span class="c">!!</span>
<a id="ln-62" name="ln-62" href="#ln-62"></a><span class="w">    </span><span class="c">!!EllipticalCoord: Given coordinates rvec, avec, and bvec, calculates an elliptical coordinate.</span>
<a id="ln-63" name="ln-63" href="#ln-63"></a><span class="w">    </span><span class="c">!!</span>
<a id="ln-64" name="ln-64" href="#ln-64"></a><span class="w">    </span><span class="c">!!EuclDist: Given two points in space, calculates their Euclidean distance.</span>
<a id="ln-65" name="ln-65" href="#ln-65"></a><span class="w">    </span><span class="c">!!</span>
<a id="ln-66" name="ln-66" href="#ln-66"></a><span class="w">    </span><span class="c">!!The main considerations:</span>
<a id="ln-67" name="ln-67" href="#ln-67"></a><span class="w">    </span><span class="c">!!This code does not handle the case where the input atomic name does not match one of the provided options in Radius_Table. This could lead to an error or unexpected behavior.</span>
<a id="ln-68" name="ln-68" href="#ln-68"></a><span class="w">    </span><span class="c">!!The recursion in fkfun does not seem to have a base case when k is less than 1, which could potentially lead to a stack overflow error.</span>
<a id="ln-69" name="ln-69" href="#ln-69"></a><span class="w">    </span><span class="c">!!There are no checks for zero or negative distances in EuclDist which might cause issues if not handled properly upstream.</span>
<a id="ln-70" name="ln-70" href="#ln-70"></a><span class="w">    </span><span class="c">!!The input values are not validated for possible errors. Adding error handling and input validation could make the code more robust.</span>
<a id="ln-71" name="ln-71" href="#ln-71"></a><span class="w">    </span><span class="c">!!The functions are tightly coupled, which might make modifications and debugging more difficult.</span>
<a id="ln-72" name="ln-72" href="#ln-72"></a><span class="w">    </span><span class="c">!.. Euclidean distance</span>
<a id="ln-73" name="ln-73" href="#ln-73"></a><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="p">(</span><span class="mi">1</span><span class="n">d0</span><span class="p">))</span><span class="w"> </span><span class="k">function </span><span class="n">EuclDist</span><span class="p">(</span><span class="n">avec</span><span class="p">,</span><span class="w"> </span><span class="n">bvec</span><span class="p">)</span><span class="w"> </span><span class="k">result</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
<a id="ln-74" name="ln-74" href="#ln-74"></a><span class="w">        </span><span class="c">!! This function calculates the Euclidean distance between two points in 3D space. The inputs are two 3-component vectors representing the coordinates of the points, and the output is a scalar representing the distance between them.</span>
<a id="ln-75" name="ln-75" href="#ln-75"></a><span class="w">        </span><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="p">(</span><span class="mi">1</span><span class="n">d0</span><span class="p">)),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">avec</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span><span class="w"> </span><span class="n">bvec</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a id="ln-76" name="ln-76" href="#ln-76"></a><span class="w">        </span><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="p">(</span><span class="mi">1</span><span class="n">d0</span><span class="p">))</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">cvec</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a id="ln-77" name="ln-77" href="#ln-77"></a><span class="w">        </span><span class="n">cvec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">avec</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">bvec</span><span class="p">)</span>
<a id="ln-78" name="ln-78" href="#ln-78"></a><span class="w">        </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">sqrt</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">cvec</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">cvec</span><span class="p">))</span>
<a id="ln-79" name="ln-79" href="#ln-79"></a><span class="w">    </span><span class="k">end function </span><span class="n">EuclDist</span>
<a id="ln-80" name="ln-80" href="#ln-80"></a><span class="w">    </span><span class="c">! ----------------------------------------------------</span>
<a id="ln-81" name="ln-81" href="#ln-81"></a><span class="w">    </span><span class="c">!.. Elliptical coordinate</span>
<a id="ln-82" name="ln-82" href="#ln-82"></a><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="p">(</span><span class="mi">1</span><span class="n">d0</span><span class="p">))</span><span class="w"> </span><span class="k">function </span><span class="n">EllipticalCoord</span><span class="p">(</span><span class="n">rvec</span><span class="p">,</span><span class="w"> </span><span class="n">avec</span><span class="p">,</span><span class="w"> </span><span class="n">bvec</span><span class="p">)</span><span class="w"> </span><span class="k">result</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
<a id="ln-83" name="ln-83" href="#ln-83"></a><span class="w">        </span><span class="c">!! Eq. 1 \( \mu_{ab}(\vec{r}) \)</span>
<a id="ln-84" name="ln-84" href="#ln-84"></a><span class="w">        </span><span class="c">!! This function calculates the elliptical coordinate (\(\mu_{ab}\)) of a point relative to two other points (defined as atoms &#39;a&#39; and &#39;b&#39;). This coordinate is a measure of how much closer the point is to atom &#39;a&#39; compared to atom &#39;b&#39;.</span>
<a id="ln-85" name="ln-85" href="#ln-85"></a><span class="w">        </span><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="p">(</span><span class="mi">1</span><span class="n">d0</span><span class="p">)),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">rvec</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span><span class="w"> </span><span class="n">avec</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span><span class="w"> </span><span class="n">bvec</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a id="ln-86" name="ln-86" href="#ln-86"></a><span class="w">        </span><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="p">(</span><span class="mi">1</span><span class="n">d0</span><span class="p">))</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">r_a</span><span class="p">,</span><span class="w"> </span><span class="n">r_b</span><span class="p">,</span><span class="w"> </span><span class="n">R_ab</span><span class="w"> </span><span class="c">! $r_a$, $r_b$, $R_ab$</span>
<a id="ln-87" name="ln-87" href="#ln-87"></a><span class="w">        </span><span class="n">r_a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">EuclDist</span><span class="p">(</span><span class="n">rvec</span><span class="p">,</span><span class="w"> </span><span class="n">avec</span><span class="p">)</span>
<a id="ln-88" name="ln-88" href="#ln-88"></a><span class="w">        </span><span class="n">r_b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">EuclDist</span><span class="p">(</span><span class="n">rvec</span><span class="p">,</span><span class="w"> </span><span class="n">bvec</span><span class="p">)</span>
<a id="ln-89" name="ln-89" href="#ln-89"></a><span class="w">        </span><span class="n">R_ab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">EuclDist</span><span class="p">(</span><span class="n">avec</span><span class="p">,</span><span class="w"> </span><span class="n">bvec</span><span class="p">)</span>
<a id="ln-90" name="ln-90" href="#ln-90"></a><span class="w">        </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">r_a</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">r_b</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">R_ab</span>
<a id="ln-91" name="ln-91" href="#ln-91"></a><span class="w">    </span><span class="k">end function </span><span class="n">EllipticalCoord</span>
<a id="ln-92" name="ln-92" href="#ln-92"></a><span class="w">    </span><span class="c">! ----------------------------------------------------</span>
<a id="ln-93" name="ln-93" href="#ln-93"></a><span class="w">    </span><span class="c">!..Radius_Table</span>
<a id="ln-94" name="ln-94" href="#ln-94"></a><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="p">(</span><span class="mi">1</span><span class="n">d0</span><span class="p">))</span><span class="w"> </span><span class="k">function </span><span class="n">Radius_Table</span><span class="p">(</span><span class="n">Atomic_Name</span><span class="p">)</span><span class="w"> </span><span class="k">result</span><span class="p">(</span><span class="n">Atomic_Radius</span><span class="p">)</span>
<a id="ln-95" name="ln-95" href="#ln-95"></a><span class="w">        </span><span class="c">!!Radius_Table for atomic radius based on atomic name</span>
<a id="ln-96" name="ln-96" href="#ln-96"></a><span class="w">        </span><span class="c">!!This function provides the atomic radius based on the atomic name. The input is a string representing the atomic name and the output is the corresponding atomic radius. This is useful for defining the size of atoms in molecular modelling.</span>
<a id="ln-97" name="ln-97" href="#ln-97"></a>
<a id="ln-98" name="ln-98" href="#ln-98"></a><span class="w">        </span><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">16</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">Atomic_Name</span>
<a id="ln-99" name="ln-99" href="#ln-99"></a>
<a id="ln-100" name="ln-100" href="#ln-100"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Atomic_Name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;H&quot;</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<a id="ln-101" name="ln-101" href="#ln-101"></a><span class="k">            </span><span class="n">Atomic_Radius</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.35</span>
<a id="ln-102" name="ln-102" href="#ln-102"></a>
<a id="ln-103" name="ln-103" href="#ln-103"></a><span class="w">        </span><span class="n">elseif</span><span class="w"> </span><span class="p">(</span><span class="n">Atomic_Name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;C&quot;</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<a id="ln-104" name="ln-104" href="#ln-104"></a><span class="k">            </span><span class="n">Atomic_Radius</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.70</span>
<a id="ln-105" name="ln-105" href="#ln-105"></a>
<a id="ln-106" name="ln-106" href="#ln-106"></a><span class="w">        </span><span class="n">elseif</span><span class="w"> </span><span class="p">(</span><span class="n">Atomic_Name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;N&quot;</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<a id="ln-107" name="ln-107" href="#ln-107"></a><span class="k">            </span><span class="n">Atomic_Radius</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.65</span>
<a id="ln-108" name="ln-108" href="#ln-108"></a>
<a id="ln-109" name="ln-109" href="#ln-109"></a><span class="w">        </span><span class="n">elseif</span><span class="w"> </span><span class="p">(</span><span class="n">Atomic_Name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;O&quot;</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<a id="ln-110" name="ln-110" href="#ln-110"></a><span class="k">            </span><span class="n">Atomic_Radius</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.60</span>
<a id="ln-111" name="ln-111" href="#ln-111"></a>
<a id="ln-112" name="ln-112" href="#ln-112"></a><span class="w">        </span><span class="n">elseif</span><span class="w"> </span><span class="p">(</span><span class="n">Atomic_Name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;Mg&quot;</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<a id="ln-113" name="ln-113" href="#ln-113"></a><span class="k">            </span><span class="n">Atomic_Radius</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.50</span>
<a id="ln-114" name="ln-114" href="#ln-114"></a><span class="w">        </span><span class="k">end if</span>
<a id="ln-115" name="ln-115" href="#ln-115"></a>
<a id="ln-116" name="ln-116" href="#ln-116"></a><span class="k">    end function </span><span class="n">Radius_Table</span>
<a id="ln-117" name="ln-117" href="#ln-117"></a><span class="w">    </span><span class="c">! ----------------------------------------------------</span>
<a id="ln-118" name="ln-118" href="#ln-118"></a><span class="w">    </span><span class="c">!..get_param_aij</span>
<a id="ln-119" name="ln-119" href="#ln-119"></a><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="p">(</span><span class="mi">1</span><span class="n">d0</span><span class="p">))</span><span class="w"> </span><span class="k">function </span><span class="n">get_param_a</span><span class="p">(</span><span class="n">R_i</span><span class="p">,</span><span class="w"> </span><span class="n">R_j</span><span class="p">)</span><span class="w"> </span><span class="k">result</span><span class="p">(</span><span class="n">a_ij</span><span class="p">)</span>
<a id="ln-120" name="ln-120" href="#ln-120"></a><span class="w">        </span><span class="c">!! This function calculates the parameter &#39;a&#39; (\(a_{ij}\)) which depends on the radii of two atoms. This parameter is used in the transformation of the elliptical coordinate.</span>
<a id="ln-121" name="ln-121" href="#ln-121"></a><span class="w">        </span><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="p">(</span><span class="mi">1</span><span class="n">d0</span><span class="p">)),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">R_i</span><span class="p">,</span><span class="w"> </span><span class="n">R_j</span>
<a id="ln-122" name="ln-122" href="#ln-122"></a><span class="w">        </span><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="p">(</span><span class="mi">1</span><span class="n">d0</span><span class="p">))</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">Chi</span>
<a id="ln-123" name="ln-123" href="#ln-123"></a><span class="w">        </span><span class="n">Chi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">R_i</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">R_j</span>
<a id="ln-124" name="ln-124" href="#ln-124"></a><span class="w">        </span><span class="n">a_ij</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">Chi</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="n">Chi</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<a id="ln-125" name="ln-125" href="#ln-125"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">a_ij</span><span class="p">)</span><span class="o">&gt;</span><span class="p">(</span><span class="mf">0.5d0</span><span class="p">))</span><span class="w"> </span><span class="k">then</span>
<a id="ln-126" name="ln-126" href="#ln-126"></a><span class="k">            </span><span class="n">a_ij</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5d0</span>
<a id="ln-127" name="ln-127" href="#ln-127"></a><span class="w">        </span><span class="k">endif</span>
<a id="ln-128" name="ln-128" href="#ln-128"></a><span class="k">    end function </span><span class="n">get_param_a</span>
<a id="ln-129" name="ln-129" href="#ln-129"></a><span class="w">    </span><span class="c">! ----------------------------------------------------</span>
<a id="ln-130" name="ln-130" href="#ln-130"></a><span class="w">    </span><span class="c">!..new_mu_transformation</span>
<a id="ln-131" name="ln-131" href="#ln-131"></a><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="p">(</span><span class="mi">1</span><span class="n">d0</span><span class="p">))</span><span class="w"> </span><span class="k">function </span><span class="n">new_mu_transformation</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span><span class="w"> </span><span class="n">a_ij</span><span class="p">)</span><span class="w"> </span><span class="k">result</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
<a id="ln-132" name="ln-132" href="#ln-132"></a><span class="w">        </span><span class="c">!! This function transforms the elliptical coordinate using the parameter &#39;a&#39; (\(a_{ij}\)). This transformation is used to handle cases where the point is much closer to one atom than the other.</span>
<a id="ln-133" name="ln-133" href="#ln-133"></a>
<a id="ln-134" name="ln-134" href="#ln-134"></a><span class="w">        </span><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="p">(</span><span class="mi">1</span><span class="n">d0</span><span class="p">)),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">mu</span><span class="p">,</span><span class="w"> </span><span class="n">a_ij</span>
<a id="ln-135" name="ln-135" href="#ln-135"></a><span class="w">        </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mu</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">a_ij</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">mu</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<a id="ln-136" name="ln-136" href="#ln-136"></a><span class="w">    </span><span class="k">end function </span><span class="n">new_mu_transformation</span>
<a id="ln-137" name="ln-137" href="#ln-137"></a><span class="w">    </span><span class="c">! ----------------------------------------------------</span>
<a id="ln-138" name="ln-138" href="#ln-138"></a><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="p">(</span><span class="mi">1</span><span class="n">d0</span><span class="p">))</span><span class="w"> </span><span class="k">recursive function </span><span class="n">fkfun</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="k">result</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
<a id="ln-139" name="ln-139" href="#ln-139"></a><span class="w">        </span><span class="c">!! Eq. 4 Recursive  \( f_k(\mu) \)</span>
<a id="ln-140" name="ln-140" href="#ln-140"></a><span class="w">        </span><span class="c">!! This function calculates a recursive function of the transformed elliptical coordinate. The output of this function will be used in the calculation of the step function skfun.</span>
<a id="ln-141" name="ln-141" href="#ln-141"></a>
<a id="ln-142" name="ln-142" href="#ln-142"></a><span class="w">        </span><span class="k">implicit none</span>
<a id="ln-143" name="ln-143" href="#ln-143"></a><span class="k">        </span><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="p">(</span><span class="mi">1</span><span class="n">d0</span><span class="p">)),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">mu</span>
<a id="ln-144" name="ln-144" href="#ln-144"></a><span class="w">        </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">k</span>
<a id="ln-145" name="ln-145" href="#ln-145"></a><span class="w">        </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5d0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">mu</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="mf">3.d0</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">mu</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<a id="ln-146" name="ln-146" href="#ln-146"></a><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">k</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span><span class="k">return</span>
<a id="ln-147" name="ln-147" href="#ln-147"></a><span class="k">        </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fkfun</span><span class="p">(</span><span class="n">res</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<a id="ln-148" name="ln-148" href="#ln-148"></a><span class="w">    </span><span class="k">end function </span><span class="n">fkfun</span>
<a id="ln-149" name="ln-149" href="#ln-149"></a><span class="w">    </span><span class="c">! ----------------------------------------------------</span>
<a id="ln-150" name="ln-150" href="#ln-150"></a><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="p">(</span><span class="mi">1</span><span class="n">d0</span><span class="p">))</span><span class="w"> </span><span class="k">function </span><span class="n">skfun</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="k">result</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
<a id="ln-151" name="ln-151" href="#ln-151"></a><span class="w">        </span><span class="c">!! \( s(\mu): [-1,1]  \rightarrow [0,1] \)  (Step Function)</span>
<a id="ln-152" name="ln-152" href="#ln-152"></a><span class="w">        </span><span class="c">!! This function calculates a step function of the transformed elliptical coordinate. This function maps the transformed elliptical coordinate from the range [-1,1] to [0,1].</span>
<a id="ln-153" name="ln-153" href="#ln-153"></a>
<a id="ln-154" name="ln-154" href="#ln-154"></a><span class="w">        </span><span class="k">implicit none</span>
<a id="ln-155" name="ln-155" href="#ln-155"></a><span class="k">        </span><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="p">(</span><span class="mi">1</span><span class="n">d0</span><span class="p">)),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">mu</span>
<a id="ln-156" name="ln-156" href="#ln-156"></a><span class="w">        </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">k</span>
<a id="ln-157" name="ln-157" href="#ln-157"></a><span class="w">        </span><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="p">(</span><span class="mi">1</span><span class="n">d0</span><span class="p">))</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">r_m</span>
<a id="ln-158" name="ln-158" href="#ln-158"></a>
<a id="ln-159" name="ln-159" href="#ln-159"></a><span class="w">        </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5d0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="mf">1.d0</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">fkfun</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="p">))</span>
<a id="ln-160" name="ln-160" href="#ln-160"></a><span class="w">    </span><span class="k">end function </span><span class="n">skfun</span>
<a id="ln-161" name="ln-161" href="#ln-161"></a><span class="w">    </span><span class="c">! ----------------------------------------------------</span>
<a id="ln-162" name="ln-162" href="#ln-162"></a><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="p">(</span><span class="mi">1</span><span class="n">d0</span><span class="p">))</span><span class="w"> </span><span class="k">function </span><span class="n">skfunab</span><span class="p">(</span><span class="n">rvec</span><span class="p">,</span><span class="w"> </span><span class="n">avec</span><span class="p">,</span><span class="w"> </span><span class="n">bvec</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="p">,</span><span class="w"> </span><span class="n">a_ij</span><span class="p">)</span><span class="w"> </span><span class="k">result</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
<a id="ln-163" name="ln-163" href="#ln-163"></a><span class="w">        </span><span class="c">!! This function combines the calculations of the transformed elliptical coordinate and the step function. The output of this function will be used in the calculation of the partial partition function Pkfuna.</span>
<a id="ln-164" name="ln-164" href="#ln-164"></a>
<a id="ln-165" name="ln-165" href="#ln-165"></a><span class="w">        </span><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="p">(</span><span class="mi">1</span><span class="n">d0</span><span class="p">)),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">rvec</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span><span class="w"> </span><span class="n">avec</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span><span class="w"> </span><span class="n">bvec</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a id="ln-166" name="ln-166" href="#ln-166"></a><span class="w">        </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">k</span>
<a id="ln-167" name="ln-167" href="#ln-167"></a><span class="w">        </span><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="p">(</span><span class="mi">1</span><span class="n">d0</span><span class="p">))</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">mu_old</span><span class="p">,</span><span class="w"> </span><span class="n">mu_new</span><span class="p">,</span><span class="w"> </span><span class="n">a_ij</span>
<a id="ln-168" name="ln-168" href="#ln-168"></a><span class="w">        </span><span class="n">mu_old</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">EllipticalCoord</span><span class="p">(</span><span class="n">rvec</span><span class="p">,</span><span class="w"> </span><span class="n">avec</span><span class="p">,</span><span class="w"> </span><span class="n">bvec</span><span class="p">)</span>
<a id="ln-169" name="ln-169" href="#ln-169"></a><span class="w">        </span><span class="n">mu_new</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new_mu_transformation</span><span class="p">(</span><span class="n">mu_old</span><span class="p">,</span><span class="w"> </span><span class="n">a_ij</span><span class="p">)</span>
<a id="ln-170" name="ln-170" href="#ln-170"></a><span class="w">        </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">skfun</span><span class="p">(</span><span class="n">mu_new</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="p">)</span>
<a id="ln-171" name="ln-171" href="#ln-171"></a><span class="w">    </span><span class="k">end function </span><span class="n">skfunab</span>
<a id="ln-172" name="ln-172" href="#ln-172"></a><span class="w">    </span><span class="c">! ----------------------------------------------------</span>
<a id="ln-173" name="ln-173" href="#ln-173"></a><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="p">(</span><span class="mi">1</span><span class="n">d0</span><span class="p">))</span><span class="w"> </span><span class="k">function </span><span class="n">Pkfuna</span><span class="p">(</span><span class="n">rvec</span><span class="p">,</span><span class="w"> </span><span class="n">iAtom</span><span class="p">,</span><span class="w"> </span><span class="n">AtCoord</span><span class="p">,</span><span class="w"> </span><span class="n">nAtoms</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="p">,</span><span class="w"> </span><span class="n">Radius_BS</span><span class="p">)</span><span class="w"> </span><span class="k">result</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
<a id="ln-174" name="ln-174" href="#ln-174"></a><span class="w">        </span><span class="c">!! Eq. 2  \( P_a(\vec{r}) \), nominator of Eq. 3</span>
<a id="ln-175" name="ln-175" href="#ln-175"></a><span class="w">        </span><span class="c">!! This function calculates the partial partition function for a specific atom. The output of this function represents the contribution of a specific atom to the total partition function.</span>
<a id="ln-176" name="ln-176" href="#ln-176"></a>
<a id="ln-177" name="ln-177" href="#ln-177"></a><span class="w">        </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">nAtoms</span><span class="p">,</span><span class="w"> </span><span class="n">iAtom</span>
<a id="ln-178" name="ln-178" href="#ln-178"></a><span class="w">        </span><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="p">(</span><span class="mi">1</span><span class="n">d0</span><span class="p">)),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">rvec</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span><span class="w"> </span><span class="n">AtCoord</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="n">nAtoms</span><span class="p">),</span><span class="w"> </span><span class="n">Radius_BS</span><span class="p">(:)</span>
<a id="ln-179" name="ln-179" href="#ln-179"></a><span class="w">        </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">k</span>
<a id="ln-180" name="ln-180" href="#ln-180"></a><span class="w">        </span><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">jAtom</span>
<a id="ln-181" name="ln-181" href="#ln-181"></a><span class="w">        </span><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="p">(</span><span class="mi">1</span><span class="n">d0</span><span class="p">))</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">a_ij</span><span class="p">,</span><span class="w"> </span><span class="n">R_i</span><span class="p">,</span><span class="w"> </span><span class="n">R_j</span>
<a id="ln-182" name="ln-182" href="#ln-182"></a><span class="w">        </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.d0</span>
<a id="ln-183" name="ln-183" href="#ln-183"></a><span class="w">        </span><span class="c">!$OMP PARALLEL DO REDUCTION(*:res) PRIVATE(jAtom, R_i, R_j, a_ij)</span>
<a id="ln-184" name="ln-184" href="#ln-184"></a><span class="w">        </span><span class="k">do </span><span class="n">jAtom</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">nAtoms</span>
<a id="ln-185" name="ln-185" href="#ln-185"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">jAtom</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">iAtom</span><span class="p">)</span><span class="w"> </span><span class="k">cycle</span>
<a id="ln-186" name="ln-186" href="#ln-186"></a><span class="k">            </span><span class="n">R_i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Radius_BS</span><span class="p">(</span><span class="n">iAtom</span><span class="p">)</span>
<a id="ln-187" name="ln-187" href="#ln-187"></a><span class="w">            </span><span class="n">R_j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Radius_BS</span><span class="p">(</span><span class="n">jAtom</span><span class="p">)</span>
<a id="ln-188" name="ln-188" href="#ln-188"></a><span class="w">            </span><span class="n">a_ij</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get_param_a</span><span class="p">(</span><span class="n">R_i</span><span class="p">,</span><span class="w"> </span><span class="n">R_j</span><span class="p">)</span>
<a id="ln-189" name="ln-189" href="#ln-189"></a><span class="w">            </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">res</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">skfunab</span><span class="p">(</span><span class="n">rvec</span><span class="p">,</span><span class="w"> </span><span class="n">AtCoord</span><span class="p">(:,</span><span class="w"> </span><span class="n">iAtom</span><span class="p">),</span><span class="w"> </span><span class="n">AtCoord</span><span class="p">(:,</span><span class="w"> </span><span class="n">jAtom</span><span class="p">),</span><span class="w"> </span><span class="n">k</span><span class="p">,</span><span class="w"> </span><span class="n">a_ij</span><span class="p">)</span>
<a id="ln-190" name="ln-190" href="#ln-190"></a><span class="w">        </span><span class="k">end do</span>
<a id="ln-191" name="ln-191" href="#ln-191"></a><span class="w">        </span><span class="c">!$OMP END PARALLEL DO</span>
<a id="ln-192" name="ln-192" href="#ln-192"></a><span class="w">    </span><span class="k">end function </span><span class="n">Pkfuna</span>
<a id="ln-193" name="ln-193" href="#ln-193"></a><span class="w">    </span><span class="c">! ----------------------------------------------------</span>
<a id="ln-194" name="ln-194" href="#ln-194"></a>
<a id="ln-195" name="ln-195" href="#ln-195"></a><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="p">(</span><span class="mi">1</span><span class="n">d0</span><span class="p">))</span><span class="w"> </span><span class="k">function </span><span class="n">PkFunTot</span><span class="p">(</span><span class="n">rvec</span><span class="p">,</span><span class="w"> </span><span class="n">AtCoord</span><span class="p">,</span><span class="w"> </span><span class="n">nAtoms</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="p">,</span><span class="w"> </span><span class="n">Radius_BS</span><span class="p">)</span><span class="w"> </span><span class="k">result</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
<a id="ln-196" name="ln-196" href="#ln-196"></a><span class="w">        </span><span class="c">!! Eq. 3 \( \sum_bP_b(\vec{r}) \) in the denominator</span>
<a id="ln-197" name="ln-197" href="#ln-197"></a><span class="w">        </span><span class="c">!! This function calculates the total partition function. This is done by summing the partial partition functions for all atoms.</span>
<a id="ln-198" name="ln-198" href="#ln-198"></a><span class="w">        </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">nAtoms</span>
<a id="ln-199" name="ln-199" href="#ln-199"></a><span class="w">        </span><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="p">(</span><span class="mi">1</span><span class="n">d0</span><span class="p">)),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">rvec</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span><span class="w"> </span><span class="n">AtCoord</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="n">nAtoms</span><span class="p">),</span><span class="w"> </span><span class="n">Radius_BS</span><span class="p">(:)</span>
<a id="ln-200" name="ln-200" href="#ln-200"></a><span class="w">        </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">k</span>
<a id="ln-201" name="ln-201" href="#ln-201"></a><span class="w">        </span><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">iAtom</span>
<a id="ln-202" name="ln-202" href="#ln-202"></a><span class="w">        </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.d0</span>
<a id="ln-203" name="ln-203" href="#ln-203"></a><span class="w">        </span><span class="c">!$OMP PARALLEL DO REDUCTION(+:res) PRIVATE(iAtom)</span>
<a id="ln-204" name="ln-204" href="#ln-204"></a><span class="w">        </span><span class="k">do </span><span class="n">iAtom</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">nAtoms</span>
<a id="ln-205" name="ln-205" href="#ln-205"></a><span class="w">            </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">res</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Pkfuna</span><span class="p">(</span><span class="n">rvec</span><span class="p">,</span><span class="w"> </span><span class="n">iAtom</span><span class="p">,</span><span class="w"> </span><span class="n">AtCoord</span><span class="p">,</span><span class="w"> </span><span class="n">nAtoms</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="p">,</span><span class="w"> </span><span class="n">Radius_BS</span><span class="p">)</span>
<a id="ln-206" name="ln-206" href="#ln-206"></a><span class="w">        </span><span class="k">end do</span>
<a id="ln-207" name="ln-207" href="#ln-207"></a><span class="w">        </span><span class="c">!$OMP END PARALLEL DO</span>
<a id="ln-208" name="ln-208" href="#ln-208"></a><span class="w">    </span><span class="k">end function </span><span class="n">PkFunTot</span>
<a id="ln-209" name="ln-209" href="#ln-209"></a><span class="w">    </span><span class="c">! ----------------------------------------------------</span>
<a id="ln-210" name="ln-210" href="#ln-210"></a><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="p">(</span><span class="mi">1</span><span class="n">d0</span><span class="p">))</span><span class="w"> </span><span class="k">function </span><span class="n">wkfun</span><span class="p">(</span><span class="n">rvec</span><span class="p">,</span><span class="w"> </span><span class="n">iAtom</span><span class="p">,</span><span class="w"> </span><span class="n">AtCoord</span><span class="p">,</span><span class="w"> </span><span class="n">nAtoms</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="p">,</span><span class="w"> </span><span class="n">Radius_BS</span><span class="p">)</span><span class="w"> </span><span class="k">result</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
<a id="ln-211" name="ln-211" href="#ln-211"></a><span class="w">        </span><span class="c">!! Eq. 3 $w_a \vec(r)$  (WEIGHTS)</span>
<a id="ln-212" name="ln-212" href="#ln-212"></a><span class="w">        </span><span class="c">!! This function calculates the weight of an atom. The weight is defined as the ratio of the partial partition function of the atom to the total partition function. This weight represents the relative importance of the atom.</span>
<a id="ln-213" name="ln-213" href="#ln-213"></a><span class="w">        </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">iAtom</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="p">,</span><span class="w"> </span><span class="n">nAtoms</span>
<a id="ln-214" name="ln-214" href="#ln-214"></a><span class="w">        </span><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="p">(</span><span class="mi">1</span><span class="n">d0</span><span class="p">)),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">rvec</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span><span class="w"> </span><span class="n">AtCoord</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="n">nAtoms</span><span class="p">),</span><span class="w"> </span><span class="n">Radius_BS</span><span class="p">(:)</span>
<a id="ln-215" name="ln-215" href="#ln-215"></a><span class="w">        </span><span class="c">!</span>
<a id="ln-216" name="ln-216" href="#ln-216"></a><span class="w">        </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pkfuna</span><span class="p">(</span><span class="n">rvec</span><span class="p">,</span><span class="w"> </span><span class="n">iAtom</span><span class="p">,</span><span class="w"> </span><span class="n">AtCoord</span><span class="p">,</span><span class="w"> </span><span class="n">nAtoms</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="p">,</span><span class="w"> </span><span class="n">Radius_BS</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">PkfunTot</span><span class="p">(</span><span class="n">rvec</span><span class="p">,</span><span class="w"> </span><span class="n">AtCoord</span><span class="p">,</span><span class="w"> </span><span class="n">nAtoms</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="p">,</span><span class="w"> </span><span class="n">Radius_BS</span><span class="p">)</span>
<a id="ln-217" name="ln-217" href="#ln-217"></a><span class="w">    </span><span class="k">end function </span><span class="n">wkfun</span>
<a id="ln-218" name="ln-218" href="#ln-218"></a><span class="w">    </span><span class="c">! ----------------------------------------------------</span>
<a id="ln-219" name="ln-219" href="#ln-219"></a><span class="w">    </span><span class="c">! &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span>
<a id="ln-220" name="ln-220" href="#ln-220"></a>
<a id="ln-221" name="ln-221" href="#ln-221"></a>
<a id="ln-222" name="ln-222" href="#ln-222"></a><span class="k">End Module </span><span class="n">Module_Becke</span>
</pre></div>

      </section>
    </div>
  </div>

      <hr>
    </div> <!-- /container -->
    <footer>
      <div class="container">
        <div class="row justify-content-between">
          <div class="col"><p>Charge Migration was developed by <br>&copy; 2023 
</p>
          </div>
          <div class="col">
            <p class="text-end">
              Documentation generated by
              <a href="https://github.com/Fortran-FOSS-Programmers/ford">FORD</a>
            </p>
          </div>
        </div>
        <br>
      </div> <!-- /container -->
    </footer>

    <!-- Bootstrap core JavaScript -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>    

    <!-- MathJax JavaScript
             ================================================== -->
             <!-- Placed at the end of the document so the pages load faster -->
        <script type="text/x-mathjax-config">
          MathJax.Hub.Config({
          TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } },
          jax: ['input/TeX','input/MathML','output/HTML-CSS'],
          extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']
          });
        </script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

          <script src="../tipuesearch/tipuesearch_content.js"></script>
          <script src="../tipuesearch/tipuesearch_set.js"></script>
          <script src="../tipuesearch/tipuesearch.js"></script>

  </body>
</html>